var HighFidelityAudio;HighFidelityAudio=(()=>{"use strict";var __webpack_modules__={300:(e,t)=>{var i=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==i)return i;throw new Error("unable to locate global object")}();e.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response},785:(e,t,i)=>{i.r(t),i.d(t,{AudioAPIData:()=>h,AvailableUserDataSubscriptionComponents:()=>pn,Axes:()=>m,AxisConfiguration:()=>p,Communicator:()=>yn,ConnectionStates:()=>Cn,Constants:()=>_,Handedness:()=>g,HiFiAudioAPIData:()=>h,HiFiAxes:()=>m,HiFiAxisConfiguration:()=>p,HiFiCommunicator:()=>yn,HiFiConnectionStates:()=>Cn,HiFiConstants:()=>_,HiFiHandedness:()=>g,HiFiLogLevel:()=>f.D,HiFiLogger:()=>f.M,HiFiUserDataStreamingScopes:()=>wn,HiFiUtilities:()=>a.H,LogLevel:()=>f.D,Logger:()=>f.M,OrientationEuler3D:()=>l,OrientationQuat3D:()=>o,Point3D:()=>s,ReceivedAudioAPIData:()=>u,ReceivedHiFiAudioAPIData:()=>u,UserDataStreamingScopes:()=>wn,UserDataSubscription:()=>bn,Utilities:()=>a.H,apiVersion:()=>Rn,eulerFromQuaternion:()=>c,eulerToQuaternion:()=>d,getBestAudioConstraints:()=>Tn,hiFiAPIVersion:()=>Rn,preciseInterval:()=>In});var n,a=i(24);class s{constructor({x:e=0,y:t=0,z:i=0}={}){this.x=e,this.y=t,this.z=i}}class o{constructor({w:e=1,x:t=0,y:i=0,z:n=0}={}){this.w=a.H.clampNonan(e,-1,1,1),this.x=a.H.clampNonan(t,-1,1,0),this.y=a.H.clampNonan(i,-1,1,0),this.z=a.H.clampNonan(n,-1,1,0)}}function r(e){return isNaN(e)||e===1/0?0:e===-1/0?-0:e%360}class l{constructor({pitchDegrees:e=0,yawDegrees:t=0,rollDegrees:i=0}={}){this.pitchDegrees=r(e),this.yawDegrees=r(t),this.rollDegrees=r(i)}}function d(e,t){const i=.5*Math.PI/180;let a=Math.cos(e.pitchDegrees*i),s=Math.cos(e.yawDegrees*i),r=Math.cos(e.rollDegrees*i),l=Math.sin(e.pitchDegrees*i),d=Math.sin(e.yawDegrees*i),c=Math.sin(e.rollDegrees*i),h=l*s*r,u=a*d*r,_=a*s*c,m=a*s*r,g=a*d*c,f=l*s*c,p=l*d*r,v=l*d*c;switch(t){case n.PitchYawRoll:return new o({x:h+g,y:u-f,z:_+p,w:m-v});case n.YawPitchRoll:return new o({x:h+g,y:u-f,z:_-p,w:m+v});case n.RollPitchYaw:return new o({x:h-g,y:u+f,z:_+p,w:m-v});case n.RollYawPitch:return new o({x:h-g,y:u+f,z:_-p,w:m+v});case n.YawRollPitch:return new o({x:h+g,y:u+f,z:_-p,w:m-v});case n.PitchRollYaw:return new o({x:h-g,y:u-f,z:_+p,w:m+v})}}function c(e,t){let i=e.x*e.x,s=e.y*e.y,o=e.z*e.z,r=e.w*e.x,d=e.w*e.y,c=e.w*e.z,h=e.x*e.y,u=e.y*e.z,_=e.z*e.x,m=1-2*(s+o),g=2*(h+c),f=2*(_-d),p=2*(h-c),v=1-2*(i+o),S=2*(u+r),b=2*(_+d),C=2*(u-r),w=1-2*(i+s),A=0,y=0,R=0;const T=.9999999;switch(t){case n.PitchYawRoll:y=Math.asin(a.H.clampNormalized(b)),Math.abs(b)<T?(A=Math.atan2(-C,w),R=Math.atan2(-p,m)):A=Math.atan2(S,v);break;case n.YawPitchRoll:A=Math.asin(a.H.clampNormalized(-C)),Math.abs(C)<T?(y=Math.atan2(b,w),R=Math.atan2(g,v)):y=Math.atan2(-f,m);break;case n.RollPitchYaw:A=Math.asin(a.H.clampNormalized(S)),Math.abs(S)<T?(y=Math.atan2(-f,w),R=Math.atan2(-p,v)):R=Math.atan2(g,m);break;case n.RollYawPitch:y=Math.asin(a.H.clampNormalized(-f)),Math.abs(f)<T?(A=Math.atan2(S,w),R=Math.atan2(g,m)):R=Math.atan2(-p,v);break;case n.YawRollPitch:R=Math.asin(a.H.clampNormalized(g)),Math.abs(g)<T?(A=Math.atan2(-C,v),y=Math.atan2(-f,m)):y=Math.atan2(b,w);break;case n.PitchRollYaw:R=Math.asin(a.H.clampNormalized(-p)),Math.abs(p)<T?(A=Math.atan2(S,v),y=Math.atan2(b,m)):y=Math.atan2(-C,w)}const I=180/Math.PI;return new l({pitchDegrees:I*A,yawDegrees:I*y,rollDegrees:I*R})}!function(e){e.PitchYawRoll="PitchYawRoll",e.YawPitchRoll="YawPitchRoll",e.RollPitchYaw="RollPitchYaw",e.RollYawPitch="RollYawPitch",e.YawRollPitch="YawRollPitch",e.PitchRollYaw="PitchRollYaw"}(n||(n={}));class h{constructor({position:e=null,orientationQuat:t=null,orientationEuler:i=null,volumeThreshold:n=null,hiFiGain:a=null,userAttenuation:s=null,userRolloff:o=null}={}){this.position=e,this.orientationQuat=t,this.orientationEuler=i,this.volumeThreshold=n,this.hiFiGain=a,this.userAttenuation=s,this.userRolloff=o,this._otherUserGainQueue={}}}class u extends h{constructor(e={}){super(e),this.providedUserID=e.providedUserID,this.hashedVisitID=e.hashedVisitID,this.volumeDecibels=e.volumeDecibels,this.isStereo=e.isStereo}}class _{constructor(){}}_.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS=10,_.DEFAULT_TRANSMIT_RATE_LIMIT_TIMEOUT_MS=50,_.DEFAULT_PROD_HIGH_FIDELITY_ENDPOINT="api.highfidelity.com",_.DEFAULT_PROD_HIGH_FIDELITY_PORT=443,_.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT={autoRetryInitialConnection:!1,maxSecondsToSpendRetryingInitialConnection:15,autoRetryOnDisconnect:!1,maxSecondsToSpendRetryingOnDisconnect:60,pauseBetweenRetriesMS:500,timeoutPerConnectionAttemptMS:5e3},_.MIN_PAUSE_BETWEEN_RETRIES=100;var m,g,f=i(649);!function(e){e.PositiveX="Positive X",e.NegativeX="Negative X",e.PositiveY="Positive Y",e.NegativeY="Negative Y",e.PositiveZ="Positive Z",e.NegativeZ="Negative Z"}(m||(m={})),function(e){e.RightHand="Right Hand",e.LeftHand="Left Hand"}(g||(g={}));class p{constructor({rightAxis:e,leftAxis:t,intoScreenAxis:i,outOfScreenAxis:n,upAxis:a,downAxis:s,handedness:o,eulerOrder:r}){Object.assign(this,{rightAxis:e,leftAxis:t,intoScreenAxis:i,outOfScreenAxis:n,upAxis:a,downAxis:s,handedness:o,eulerOrder:r})}}let v=new p({rightAxis:m.PositiveX,leftAxis:m.NegativeX,intoScreenAxis:m.PositiveY,outOfScreenAxis:m.NegativeY,upAxis:m.PositiveZ,downAxis:m.NegativeZ,handedness:g.RightHand,eulerOrder:n.YawPitchRoll});class S{static verify(e){let t=!0;return e.rightAxis===m.PositiveX&&e.leftAxis!==m.NegativeX&&(f.M.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.leftAxis===m.PositiveX&&e.rightAxis!==m.NegativeX&&(f.M.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.rightAxis===m.PositiveY&&e.leftAxis!==m.NegativeY&&(f.M.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.leftAxis===m.PositiveY&&e.rightAxis!==m.NegativeY&&(f.M.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.rightAxis===m.PositiveZ&&e.leftAxis!==m.NegativeZ&&(f.M.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.leftAxis===m.PositiveZ&&e.rightAxis!==m.NegativeZ&&(f.M.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.intoScreenAxis===m.PositiveX&&e.outOfScreenAxis!==m.NegativeX&&(f.M.error(`Invalid axis configuration!\nIntoScreen Axis is ${e.intoScreenAxis}, and OutOfScreen Axis is ${e.outOfScreenAxis}!`),t=!1),e.outOfScreenAxis===m.PositiveX&&e.intoScreenAxis!==m.NegativeX&&(f.M.error(`Invalid axis configuration!\nIntoScreen Axis is ${e.intoScreenAxis}, and OutOfScreen Axis is ${e.outOfScreenAxis}!`),t=!1),e.intoScreenAxis===m.PositiveY&&e.outOfScreenAxis!==m.NegativeY&&(f.M.error(`Invalid axis configuration!\nIntoScreen Axis is ${e.intoScreenAxis}, and OutOfScreen Axis is ${e.outOfScreenAxis}!`),t=!1),e.outOfScreenAxis===m.PositiveY&&e.intoScreenAxis!==m.NegativeY&&(f.M.error(`Invalid axis configuration!\nIntoScreen Axis is ${e.intoScreenAxis}, and OutOfScreen Axis is ${e.outOfScreenAxis}!`),t=!1),e.intoScreenAxis===m.PositiveZ&&e.outOfScreenAxis!==m.NegativeZ&&(f.M.error(`Invalid axis configuration!\nIntoScreen Axis is ${e.intoScreenAxis}, and OutOfScreen Axis is ${e.outOfScreenAxis}!`),t=!1),e.outOfScreenAxis===m.PositiveZ&&e.intoScreenAxis!==m.NegativeZ&&(f.M.error(`Invalid axis configuration!\nIntoScreen Axis is ${e.intoScreenAxis}, and OutOfScreen Axis is ${e.outOfScreenAxis}!`),t=!1),e.upAxis===m.PositiveX&&e.downAxis!==m.NegativeX&&(f.M.error(`Invalid axis configuration!\nUp Axis is ${e.upAxis}, and Down Axis is ${e.downAxis}!`),t=!1),e.downAxis===m.PositiveX&&e.upAxis!==m.NegativeX&&(f.M.error(`Invalid axis configuration!\nUp Axis is ${e.upAxis}, and Down Axis is ${e.downAxis}!`),t=!1),e.upAxis===m.PositiveY&&e.downAxis!==m.NegativeY&&(f.M.error(`Invalid axis configuration!\nUp Axis is ${e.upAxis}, and Down Axis is ${e.downAxis}!`),t=!1),e.downAxis===m.PositiveY&&e.upAxis!==m.NegativeY&&(f.M.error(`Invalid axis configuration!\nUp Axis is ${e.upAxis}, and Down Axis is ${e.downAxis}!`),t=!1),e.upAxis===m.PositiveZ&&e.downAxis!==m.NegativeZ&&(f.M.error(`Invalid axis configuration!\nUp Axis is ${e.upAxis}, and Down Axis is ${e.downAxis}!`),t=!1),e.downAxis===m.PositiveZ&&e.upAxis!==m.NegativeZ&&(f.M.error(`Invalid axis configuration!\nUp Axis is ${e.upAxis}, and Down Axis is ${e.downAxis}!`),t=!1),e.handedness!==g.RightHand&&e.handedness!==g.LeftHand&&(f.M.error(`Invalid axis configuration!\nHandedness is ${e.handedness}!`),t=!1),t}static translatePoint3DToMixerSpace(e,t){let i=new s;return i=t,i}static translatePoint3DFromMixerSpace(e,t){let i=new s;return i=t,i}static translateOrientationQuat3DToMixerSpace(e,t){let i=new o;return i=t,i}static translateOrientationQuat3DFromMixerSpace(e,t){let i=new o;return i=t,i}}var b,C=!0;class w{static createUUID(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}static log(e,t){if(void 0!==t&&(e=t+": "+e),C&&console.log(e),"undefined"!=typeof document&&C)try{document.dispatchEvent(new CustomEvent("logger",{detail:e}))}catch(t){console.log(e),console.log("Additionally, an error was encountered trying to log that."),console.log(t)}}static err(e,t){void 0!==t&&(e=t+": "+e),console.log("%c %s","color: #FB0A1C",e),"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("errlogger",{detail:e}))}static safelyPrintable(e){try{return JSON.stringify(e)}catch(t){return e}}static getElementCSSSize(e){if(getComputedStyle){var t=getComputedStyle(e);return{width:parseInt(t.getPropertyValue("width"),10),height:parseInt(t.getPropertyValue("height"),10)}}}static setDebug(e){C=e}}!function(e){e.CONNECTING="connecting",e.OPEN="open",e.ERROR="error",e.CLOSING="closing",e.CLOSED="closed",e.UNAVAILABLE="unavailable"}(b||(b={}));class A{constructor(){w.log("Constructor","RaviSignalingConnection"),this._stateChangeHandlers=new Set,this._messageHandlers=new Set,this._state=b.CLOSED,this._signalingImplementation=new R(this)}getState(){return this._state}addStateChangeHandler(e){try{return this._stateChangeHandlers.add(e),!0}catch(e){return w.err("Error adding a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}removeStateChangeHandler(e){try{return this._stateChangeHandlers.delete(e),!0}catch(e){return w.err("Error removing a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}addMessageHandler(e){try{return this._messageHandlers.add(e),!0}catch(e){return w.err("Error adding a message handler: "+e.message,"RaviSignalingConnection"),!1}return!1}removeMessageHandler(e){try{return this._messageHandlers.delete(e),!0}catch(e){return w.err("Error removing a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}openRAVISignalingConnection(e){var t=this;return this._state===b.OPEN?Promise.resolve("There is already an open WebSocket connection. To reconnect, first close the existing WebSocket and then attempt to open again."):new Promise(((i,n)=>{t._resolveOpen=i,t._rejectOpen=n,w.log("Opening signaling connection to "+e,"RaviSignalingController");let a={state:b.CONNECTING};this._handleStateChange(a,b.CONNECTING),this._signalingImplementation._open(e)}))}send(e){this._signalingImplementation._send(e)}closeRAVISignalingConnection(){var e=this;return this._state===b.CLOSED?Promise.resolve("Signaling connection is already closed."):new Promise(((t,i)=>{e._resolveClose=t,e._rejectClose=i,w.log("Closing signaling connection","RaviSignalingController");let n={state:b.CLOSING};this._handleStateChange(n,b.CLOSING),this._signalingImplementation._close()}))}_handleStateChange(e={},t){this._fulfillPromises(e,t),t!==this._state&&(this._state=t,e.state=t,w.log("_handleStateChange: "+w.safelyPrintable(e),"RaviSignalingConnection"),this._stateChangeHandlers.forEach((function(t){t&&t(e)})))}_fulfillPromises(e={},t){let i=e.reason||e.message||t;switch(w.log("_fulfillPromises: Handling state "+t,"RaviSignalingConnection"),t){case b.OPEN:this._resolveOpen&&this._resolveOpen(),this._rejectClose&&this._rejectClose(i);break;case b.CLOSED:this._rejectOpen&&this._rejectOpen(i),this._resolveClose&&this._resolveClose();break;case b.ERROR:this._rejectOpen&&this._rejectOpen(i),this._rejectClose&&this._rejectClose(i);break;case b.UNAVAILABLE:this._rejectOpen&&this._rejectOpen(i),this._resolveClose&&this._resolveClose();break;default:w.log("_fulfillPromises: Skipping in-progress state "+t,"RaviSignalingConnection")}}_handleMessage(e){if(w.log("_doOnmessage: "+w.safelyPrintable(e),"RaviSignalingConnection"),e.data)try{let t=JSON.parse(e.data);t.error&&"service-unavailable"===t.error&&this._handleStateChange({},b.UNAVAILABLE)}catch(e){}this._messageHandlers.forEach((function(t){t&&t(e)}))}}let y=null;y="undefined"==typeof self?i(26):WebSocket;class R{constructor(e){this._onWebSocketOpen=function(e){this._raviSignalingConnection._handleStateChange(e,b.OPEN)}.bind(this),this._onWebSocketError=function(e){this._raviSignalingConnection._handleStateChange(e,b.ERROR)}.bind(this),this._onWebSocketClose=function(e){e&&e.code&&e.code>4e3?(w.err("_handleStateChange: signaling error code "+e.code+":  "+e.reason,"RaviSignalingConnection"),this._raviSignalingConnection._handleStateChange(e,b.ERROR)):this._raviSignalingConnection._handleStateChange(e,b.CLOSED)}.bind(this),w.log("constructor","RaviSignalingWebSocketImplementation"),this._raviSignalingConnection=e}_open(e){var t=this._raviSignalingConnection;this._webSocket&&this._webSocket.readyState===y.OPEN?t._handleStateChange({},b.OPEN):(this._webSocket=new y(e),this._webSocket.addEventListener("open",this._onWebSocketOpen),this._webSocket.addEventListener("error",this._onWebSocketError),this._webSocket.addEventListener("close",this._onWebSocketClose),this._webSocket.addEventListener("message",(function(e){t._handleMessage(e)})))}_send(e){this._webSocket&&this._webSocket.readyState===y.OPEN&&(w.log("Sending message to server: "+e,"RaviSignalingWebSocketImplementation"),this._webSocket.send(e))}_close(){var e=this._raviSignalingConnection;if(!this._webSocket)return void e._handleStateChange({},b.CLOSED);let t=this._webSocket;this._webSocket=null,t.removeEventListener("open",this._onWebSocketOpen),t.removeEventListener("error",this._onWebSocketError),t.removeEventListener("close",this._onWebSocketClose),t.close(),e._handleStateChange({},b.CLOSED)}}class T{constructor(e){w.log("constructor","RaviStreamController"),this._commandController=e,this._audioStream=null,this._videoStream=null,this._onVideoStreamStateChanged=function(e){w.log("onvideostreamstatechanged "+e,"RaviStreamController")},this._onInputAudioChanged=null,this._onInputVideoChanged=null}getVideoStream(){return this._videoStream}_setVideoStream(e){this._videoStream=e,this._videoContainer&&(this._videoContainer.srcObject=this._videoStream)}setVideoContainer(e,t){this._videoContainer=e,this._videoStream&&(this._videoContainer.srcObject=this._videoStream),this.setVideoStateChangeHandler(t)}setVideoStateChangeHandler(e){e&&(this._onVideoStreamStateChanged=e)}showVideoDashboard(e){this._commandController.queueCommand("video.showDashboard",{enabled:e},null)}showVideoCursor(e){this._commandController.queueCommand("video.showCursor",{enabled:e},null)}getAudioStream(){return this._audioStream}_setAudioStream(e){this._audioStream=e,this._audioContainer&&(this._audioContainer.srcObject=this._audioStream)}setAudioContainer(e){this._audioContainer=e,this._audioStream&&(this._audioContainer.srcObject=this._audioStream)}setInputAudio(e,t=!1){this._inputAudioStream=e,this._isStereo=t,this._onInputAudioChanged&&this._onInputAudioChanged(e)}setInputAudioChangeHandler(e){e&&(this._onInputAudioChanged=e)}setInputVideo(e){this._inputVideoStream=e,this._onInputVideoChanged&&this._onInputVideoChanged(e)}setInputVideoChangeHandler(e){e&&(this._onInputVideoChanged=e)}isStereoInput(){return this._isStereo}_stop(){w.log("stopping streams","RaviStreamController"),this._videoContainer&&this._videoContainer.srcObject&&(this._videoContainer.srcObject.getTracks().forEach((e=>e.stop())),this._videoContainer.srcObject=null,this._onVideoStreamStateChanged("over")),this._audioStream&&(this._audioStream.getTracks().forEach((e=>e.stop())),this._audioStream=null)}}const I="_BINARY";var x;!function(e){e[e.ControlLeft=0]="ControlLeft",e[e.AltLeft=1]="AltLeft",e[e.OSLeft=2]="OSLeft",e[e.Space=3]="Space",e[e.OSRight=4]="OSRight",e[e.AltRight=5]="AltRight",e[e.ControlRight=6]="ControlRight",e[e.ShiftLeft=7]="ShiftLeft",e[e.ShiftRight=8]="ShiftRight",e[e.Comma=9]="Comma",e[e.Period=10]="Period",e[e.Slash=11]="Slash",e[e.CapsLock=12]="CapsLock",e[e.Enter=13]="Enter",e[e.Semicolon=14]="Semicolon",e[e.Quote=15]="Quote",e[e.Tab=16]="Tab",e[e.BracketLeft=17]="BracketLeft",e[e.BracketRight=18]="BracketRight",e[e.Backslash=19]="Backslash",e[e.Backquote=20]="Backquote",e[e.Minus=21]="Minus",e[e.Equal=22]="Equal",e[e.Digit0=23]="Digit0",e[e.Digit1=24]="Digit1",e[e.Digit2=25]="Digit2",e[e.Digit3=26]="Digit3",e[e.Digit4=27]="Digit4",e[e.Digit5=28]="Digit5",e[e.Digit6=29]="Digit6",e[e.Digit7=30]="Digit7",e[e.Digit8=31]="Digit8",e[e.Digit9=32]="Digit9",e[e.Backspace=33]="Backspace",e[e.Escape=34]="Escape",e[e.ArrowLeft=35]="ArrowLeft",e[e.ArrowRight=36]="ArrowRight",e[e.ArrowDown=37]="ArrowDown",e[e.ArrowUp=38]="ArrowUp",e[e.PageDown=39]="PageDown",e[e.PageUp=40]="PageUp",e[e.End=41]="End",e[e.Home=42]="Home",e[e.Delete=43]="Delete",e[e.Insert=44]="Insert",e[e.Numpad0=45]="Numpad0",e[e.Numpad1=46]="Numpad1",e[e.Numpad2=47]="Numpad2",e[e.Numpad3=48]="Numpad3",e[e.Numpad4=49]="Numpad4",e[e.Numpad5=50]="Numpad5",e[e.Numpad6=51]="Numpad6",e[e.Numpad7=52]="Numpad7",e[e.Numpad8=53]="Numpad8",e[e.Numpad9=54]="Numpad9",e[e.NumpadDecimal=55]="NumpadDecimal",e[e.NumpadEnter=56]="NumpadEnter",e[e.NumpadAdd=57]="NumpadAdd",e[e.NumpadSubtract=58]="NumpadSubtract",e[e.NumLock=59]="NumLock",e[e.NumpadEqual=60]="NumpadEqual",e[e.NumpadMultiply=61]="NumpadMultiply",e[e.NumpadDivide=62]="NumpadDivide",e[e.KeyA=63]="KeyA",e[e.KeyB=64]="KeyB",e[e.KeyC=65]="KeyC",e[e.KeyD=66]="KeyD",e[e.KeyE=67]="KeyE",e[e.KeyF=68]="KeyF",e[e.KeyG=69]="KeyG",e[e.KeyH=70]="KeyH",e[e.KeyI=71]="KeyI",e[e.KeyJ=72]="KeyJ",e[e.KeyK=73]="KeyK",e[e.KeyL=74]="KeyL",e[e.KeyM=75]="KeyM",e[e.KeyN=76]="KeyN",e[e.KeyO=77]="KeyO",e[e.KeyP=78]="KeyP",e[e.KeyQ=79]="KeyQ",e[e.KeyR=80]="KeyR",e[e.KeyS=81]="KeyS",e[e.KeyT=82]="KeyT",e[e.KeyU=83]="KeyU",e[e.KeyV=84]="KeyV",e[e.KeyW=85]="KeyW",e[e.KeyX=86]="KeyX",e[e.KeyY=87]="KeyY",e[e.KeyZ=88]="KeyZ"}(x||(x={}));class D{constructor(){w.log("constructor","RaviCommandController"),this._commandQueueMap=new Map,this._numQueuedCommands=0,this._commandQueueInterval=1e3,this._commandPumpTimer=null,this._inputTarget,this._keyboardTarget,this._mouseStateBuffer=new ArrayBuffer(32),this._mouseStateUint8=new Uint8Array(this._mouseStateBuffer),this._mouseStateUint8[0]=77,this._mouseStateFloat=new Float32Array(this._mouseStateBuffer,4),this._mouseStateFloat[0]=-1,this._mouseStateFloat[1]=-1,this._mouseStateFloat[2]=-1,this._mouseStateFloat[3]=-1,this._keyboardStateBuffer=new ArrayBuffer(13),this._keyboardState=new Uint8Array(this._keyboardStateBuffer),this._keyboardState[0]=75}setCommandQueueInterval(e){this._commandQueueInterval=e,this._commandPumpTimer&&(this.stopMonitoringQueues(),this.monitorQueues())}queueCommand(e,t,i){var n=this._commandQueueMap.get(e);n||(n={toSend:[],listener:[]},this._commandQueueMap.set(e,n));var a=null;i&&(a=new E(i,!1,!0)),n.toSend.push(new k(e,t,a)),this._numQueuedCommands++,w.log("Added command "+e,"RaviCommandController")}queueBinaryCommand(e){let t=I;var i=this._commandQueueMap.get(t);i||(i={toSend:[],listener:[]},this._commandQueueMap.set(t,i)),i.toSend.push(new k(e,null,null)),this._numQueuedCommands++,w.log("Added binary command","RaviCommandController")}addMessageHandler(e,t,i){var n=this._commandQueueMap.get(e);n||(n={toSend:[],listener:[]},this._commandQueueMap.set(e,n));var a=new E(t,i,!1);n.listener.push(a)}addBinaryHandler(e,t){this.addMessageHandler(I,e,t)}sendInput(e){this._inputDataChannel&&"open"===this._inputDataChannel.readyState&&this._inputDataChannel.send(e)}monitorQueues(){w.log("Begin monitoring for queued commands","RaviCommandController"),this._commandPumpTimer=setInterval(this._processSendingQueuedCommands.bind(this),this._commandQueueInterval)}stopMonitoringQueues(){w.log("Stop monitoring for queued commands","RaviCommandController"),clearInterval(this._commandPumpTimer),this._commandPumpTimer=null}_processSendingQueuedCommands(){this._numQueuedCommands<=0||this._commandQueueMap.forEach(function(e,t,i){if(e.toSend.length){var n=e.toSend.shift();n._handler&&e.listener.push(n._handler),this._sendCommandInstance(n)?this._numQueuedCommands--:w.log("Send failed. CommandDataChannel may have been disconnected. Will not retry.","RaviCommandController")}}.bind(this))}_serializeJsonCommandMessageToSend(e,t){return JSON.stringify({c:e,p:t})}_unserializeJsonCommandMessageFromReceived(e){let t;try{t=JSON.parse(e)}catch(t){return void w.err(`Couldn't parse command message! Error:\n${t}\n Full message contents:\n${e}`,"RaviCommandController")}return t&&t.c&&t.p?{command:t.c,payload:t.p}:(w.err("Message cannot be unserialized into a CommandMessage: "+e,"RaviCommandController"),null)}_sendCommandInstance(e){try{let t=e._command;return"string"==typeof t?(t=this._serializeJsonCommandMessageToSend(e._command,e._param),w.log("Sending command "+t,"RaviCommandController")):w.log("Sending binary command","RaviCommandController"),this._commandDataChannel.send(t),!0}catch(e){return w.err("Received error while sending: "+e.message,"RaviCommandController"),!1}}_processListeningCommand(e){let t=e.data,i=null;t&&("string"==typeof t?(i=this._unserializeJsonCommandMessageFromReceived(t),this._continueProcessingListeningCommand(i)):t instanceof ArrayBuffer?(i={command:I,payload:new Uint8Array(t)},this._continueProcessingListeningCommand(i)):t instanceof Blob&&t.arrayBuffer().then((e=>{i={command:I,payload:new Uint8Array(e)},this._continueProcessingListeningCommand(i)})))}_continueProcessingListeningCommand(e){if(e){var t=this._commandQueueMap.get(e.command);if(t){var i=t.listener.length;if(i>0)if(t.listener[0]&&t.listener[0]._hasMatchingSentCommand){var n=t.listener.shift();if(n&&n._handler)return void n._handler(e.payload);w.err("Undefined command handler: "+e,"RaviCommandController")}else{for(var a=[],s=0;s<i;s++){var o=t.listener[s];o&&o._handler?o._handler(e.payload):w.err("Undefined message handler: "+e,"RaviCommandController"),o&&o._isSticky&&a.push(o)}t.listener=a}}}else w.err("Received invalid command message, ignoring: "+JSON.stringify(e),"RaviCommandController")}_setInputDataChannel(e){this._inputDataChannel=e,w.log("Received new input data channel with id "+this._inputDataChannel.id,"RaviCommandController"),this._inputDataChannel.onopen=function(){w.log("_inputDataChannel onopen, state is "+this._inputDataChannel.readyState,"RaviCommandController")}.bind(this),this._inputDataChannel.onclose=function(){w.log("_inputDataChannel onclose, state is "+this._inputDataChannel.readyState,"RaviCommandController")}.bind(this),this._inputDataChannel.onmessage=function(e){w.log("_inputDataChannel got message: "+e.data,"RaviCommandController")}.bind(this)}_setCommandDataChannel(e){this._commandDataChannel=e,w.log("Received new data channel with id "+this._commandDataChannel.id,"RaviCommandController"),this._commandDataChannel.onopen=function(){w.log("_commandDataChannel ononpen, state is "+this._commandDataChannel.readyState,"RaviCommandController"),this.monitorQueues()}.bind(this),this._commandDataChannel.onclose=function(){w.log("_commandDataChannel onclose, state is "+this._commandDataChannel.readyState,"RaviCommandController"),this.stopMonitoringQueues()}.bind(this),this._commandDataChannel.onmessage=function(e){this._processListeningCommand(e)}.bind(this)}setInputTarget(e){if(this._inputTarget&&(this._inputTarget.onmousemove=null,this._inputTarget.onmouseenter=null,this._inputTarget.onmouseleave=null,this._inputTarget.onmousedown=null,this._inputTarget.onmouseup=null,this._inputTarget.onwheel=null),this._inputTarget=e,this._inputTarget){var t=this;this._inputTarget.onmousemove=function(e){t._trackMouse(e)},this._inputTarget.onmouseenter=null,this._inputTarget.onmouseleave=null,this._inputTarget.onmousedown=function(e){t._captureMouseDown(e)},this._inputTarget.onmouseup=function(e){t._resetMouseDown(e)},this._inputTarget.onwheel=function(e){t._wheelMouse(e)}}}setKeyboardTarget(e){if(this._keyboardTarget&&(this._keyboardTarget.onkeydown=null,this._keyboardTarget.onkeyup=null),this._keyboardTarget=e,this._keyboardTarget){var t=this;this._keyboardTarget.onkeydown=function(e){t._onKeyboardDown(e)},this._keyboardTarget.onkeyup=function(e){t._onKeyboardUp(e)}}}_captureMouseDown(e){this._mouseStateFloat[0]=e.offsetX,this._mouseStateFloat[1]=e.offsetY,this._mouseStateFloat[2]=e.offsetX,this._mouseStateFloat[3]=e.offsetY,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_resetMouseDown(e){this._mouseStateFloat[0]=-1,this._mouseStateFloat[1]=-1,this._mouseStateFloat[2]=-1,this._mouseStateFloat[3]=-1,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_trackMouse(e){this._mouseStateFloat[0]=e.offsetX,this._mouseStateFloat[1]=e.offsetY,this._mouseStateFloat[4]=this._inputTarget.offsetWidth,this._mouseStateFloat[5]=this._inputTarget.offsetHeight,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_wheelMouse(e){this._mouseStateFloat[6]=e.deltaY,this._sendMouseState(),this._mouseStateFloat[6]=0}_sendMouseState(){this.sendInput(this._mouseStateBuffer)}_keyByteNum(e){return e>>3}_keyBitMask(e){return 1<<e%8}_onKeyboardDown(e){let t=x[e.code],i=1+this._keyByteNum(t),n=this._keyBitMask(t);0==(this._keyboardState[i]&n)&&(this._keyboardState[i]|=n,this._sendKeyboardState())}_onKeyboardUp(e){let t=x[e.code],i=1+this._keyByteNum(t),n=this._keyBitMask(t);0!=(this._keyboardState[i]&n)&&(this._keyboardState[i]^=n,this._sendKeyboardState())}_sendKeyboardState(){this.sendInput(this._keyboardStateBuffer)}}class k{constructor(e,t,i){w.log("constructor","RaviCommandInstance"),this._command=e,this._param=t,this._handler=i}}class E{constructor(e,t,i){w.log("constructor","RaviCommandHandlerInstance"),this._handler=e,this._isSticky=t,this._hasMatchingSentCommand=i}}var M,O=function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.NEW="new",e.CONNECTING="checking",e.CONNECTED="connected",e.COMPLETED="completed",e.DISCONNECTED="disconnected",e.FAILED="failed",e.CLOSED="closed"}(M||(M={}));class P{constructor(){this._stateChangeHandlers=new Set,this._uuid=w.createUUID(),this._commandController=new D,this._streamController=new T(this._commandController),this._state=M.CLOSED,this._raviImplementation=new B(this);const e=this._raviImplementation;this._streamController.setInputAudioChangeHandler(e._addAudioInputStream.bind(e)),this._streamController.setInputVideoChangeHandler(e._addVideoInputStream.bind(e))}getState(){return this._state}getUUID(){return this._uuid}addStateChangeHandler(e){try{return this._stateChangeHandlers.add(e),!0}catch(e){return w.err("Error adding a state change handler: "+e.message,"RaviSession"),!1}return!1}removeStateChangeHandler(e){try{return this._stateChangeHandlers.delete(e),!0}catch(e){return w.err("Error removing a state change handler: "+e.message,"RaviSession"),!1}return!1}getCommandController(){return this._commandController}getStreamController(){return this._streamController}openRAVISession({signalingConnection:e,timeout:t=5e3,params:i=null,customStunAndTurn:n=null}){if(this._state===M.CONNECTED||this._state===M.COMPLETED)return Promise.resolve("There is already an open RAVI session. To reconnect, first close the existing connection, and then attempt to open again.");var a=this;return this._raviImplementation._assignSignalingConnection(e),this._openingTimeout=setTimeout((()=>{let e="RaviSession.open timed out after "+t+" ms";w.log(e,"RaviSession"),a._fulfillPromises({message:e},M.FAILED),a.closeRAVISession()}),t),new Promise(((e,t)=>{a._resolveOpen=e,a._rejectOpen=t,w.log("Opening RAVI session","RaviSession"),this._state=M.NEW,a._raviImplementation._open(i,n)}))}closeRAVISession(){var e=this;return this._state===M.CLOSED?Promise.resolve("RAVI session is already closed."):(this._streamController._stop(),this._commandController.stopMonitoringQueues(),new Promise(((t,i)=>{e._resolveClose=t,e._rejectClose=i,w.log("Closing RAVI session","RaviSession"),e._raviImplementation._close()})))}_fulfillPromises(e={},t){let i=e.reason||e.message||t;switch(t){case M.CONNECTED:case M.COMPLETED:this._openingTimeout&&(clearTimeout(this._openingTimeout),this._openingTimeout=null),this._resolveOpen&&this._resolveOpen(),this._rejectClose&&this._rejectClose(i);break;case M.DISCONNECTED:w.log("_fulfillPromises: Possible transitory state DISCONNECTED; leaving promises pending","RaviSession");break;case M.FAILED:this._openingTimeout&&(clearTimeout(this._openingTimeout),this._openingTimeout=null),this._rejectOpen&&this._rejectOpen(i),this._rejectClose&&this._rejectClose(i);let e=this;setTimeout((()=>{e._raviImplementation._close()}),0);break;case M.CLOSED:this._openingTimeout&&(clearTimeout(this._openingTimeout),this._openingTimeout=null),this._rejectOpen&&this._rejectOpen(i),this._resolveClose&&this._resolveClose();break;default:w.log("_fulfillPromises: Skipping in-progress state "+t,"RaviSession")}}_doOntrack(e){w.log("Received new track: ","RaviSession"),w.log(e,"RaviSession"),e&&e.track&&"video"===e.track.kind&&(w.log("Adding remote video track to stream controller","RaviSession"),this._streamController._setVideoStream(e.streams[0]),this._streamController._onVideoStreamStateChanged("ready")),e&&e.track&&"audio"===e.track.kind&&(w.log("Adding remote audio track to stream controller","RaviSession"),this._streamController._setAudioStream(e.streams[0]))}_doOndatachannel(e){switch(w.log("Received new channel: ","RaviSession"),w.log(e,"RaviSession"),e.channel.label){case"ravi.input":this._commandController._setInputDataChannel(e.channel);break;case"ravi.command":this._commandController._setCommandDataChannel(e.channel);break;default:w.log("Received unknown data channel named "+e.channel.label,"RaviSession")}}_handleStateChange(e={},t){e.state=t,this._fulfillPromises(e,t),t!==this._state&&(this._state=t,e.state=t,w.log("_handleStateChange: "+w.safelyPrintable(e),"RaviSession"),this._stateChangeHandlers.forEach((function(t){t&&t(e)})))}addStatsObserver(e){return this._raviImplementation._addStatsObserver(e)}removeStatsObserver(e){return this._raviImplementation._removeStatsObserver(e)}}const N=new Map([["remote-inbound-rtp",["id","type","timestamp","roundTripTime","jitter"]],["inbound-rtp",["id","type","timestamp","jitterBufferDelay","jitterBufferEmittedCount","bytesReceived"]]]);class U{constructor(e){w.log("constructor","RaviStatsWatcher"),this._raviImplementation=e,this._observers=new Set,this._filter=N,this._interval=0,this._prevStats=[]}stop(){this._interval&&(clearInterval(this._interval),this._interval=0)}addObserver(e){try{return this._observers.add(e),this._onObserverChange(),!0}catch(e){return w.err("Error adding a stats observer: "+e.message,"RaviStatsWatcher"),!1}return!1}removeObserver(e){try{return this._observers.delete(e),this._onObserverChange(),!0}catch(e){return w.err("Error removing a stats observer handler: "+e.message,"RaviSession"),!1}return!1}_onObserverChange(){this._prevStats=[],this._observers.size>0?this._interval||setInterval(((e,t)=>O(this,void 0,void 0,(function*(){const e=yield this._raviImplementation._getStats();let t=[];e&&e.forEach((e=>{if(this._filter.has(e.type)){let i=this._filter.get(e.type),n={};i.forEach((t=>{n[t]=e[t]})),t.push(n)}})),t.length&&this._observers.forEach((e=>{e(t,this._prevStats)})),this._prevStats=t}))),1e3):this._interval&&(clearInterval(this._interval),this._interval=0)}}let F=null,H=null;"undefined"==typeof self?(F=i(326).I$,H=i(326).Ao):(F=RTCPeerConnection,H=RTCSessionDescription);const L={urls:["stun:stun.l.google.com:19302"]};let z={iceServers:[L,{urls:["turn:turn.highfidelity.com:3478"],username:"clouduser",credential:"chariot-travesty-hook"}]};class B{constructor(e){w.log("constructor","RaviWebRTCImplementation"),this._raviSession=e,this._negotiator=this._setupConnection.bind(this),this._statsWatcher=new U(this),this._raviAudioSenders=[],this._raviVideoSenders=[]}_initRtcConnection(){const e=this._raviSession,t=this;this._rtcConnection=new F(z);const i=this._rtcConnection;i.getSenders().forEach((e=>{e.replaceTrack(null)})),this._raviAudioSenders=[],this._raviVideoSenders=[],i.addEventListener("iceconnectionstatechange",(function(n){"connected"!==i.iceConnectionState&&"completed"!=i.iceConnectionState||(w.log("Session has fully connected; removing short-circuit handler","RaviWebRTCImplementation"),t._signalingConnection.removeStateChangeHandler(t._shortCircuitHandler)),e._handleStateChange(n,i.iceConnectionState)})),i.addEventListener("datachannel",(function(t){e._doOndatachannel(t)})),i.addEventListener("track",(function(t){e._doOntrack(t)})),i.addEventListener("icecandidate",(function(e){t._doOnicecandidate(e)})),i.addEventListener("negotiationneeded",(function(e){t._doOnnegotiationneeded(e)})),i.addEventListener("signalingstatechange",(function(e){t._doOnsignalingstatechanged(e)}))}_assignSignalingConnection(e){this._signalingConnection=e}_addAudioInputStream(e){const t=this._rtcConnection;if(e){if(this._audioInputStream=e,!t)return w.log("Setting audio input stream without available RTC connection; will store it until ready","RaviWebRTCImplementation"),!0;const i=this._raviAudioSenders,n=e.getAudioTracks(),a=n.length;let s=0;for(;s<i.length;s++)s<a?(w.log("Replacing audio track #"+s+"  in rtcConnection","RaviWebRTCImplementation"),i[s].replaceTrack(n[s])):(w.log("Setting audio sender #"+s+" to null","RaviWebRTCImplementation"),i[s].replaceTrack(null));for(;s<a;s++)w.log("Adding local audio track #"+s+" to rtcConnection","RaviWebRTCImplementation"),i.push(t.addTrack(n[s],e))}else{const e=this._raviAudioSenders;let t=0;for(;t<e.length;t++)w.log("Setting audio sender #"+t+" to null","RaviWebRTCImplementation"),e[t].replaceTrack(null)}return!1}_addVideoInputStream(e){const t=this._rtcConnection;var i=!1;if(e){if(this._videoInputStream=e,!t)return w.log("Setting video input stream without available RTC connection; will store it until ready","RaviWebRTCImplementation"),!0;const n=this._raviVideoSenders,a=e.getVideoTracks();a.length>0?(n.length>0?(w.log("Replacing video track #0 in rtcConnection","RaviWebRTCImplementation"),n[0].replaceTrack(a[0])):(w.log("Adding video track #0 to rtcConnection","RaviWebRTCImplementation"),n.push(t.addTrack(a[0]))),i=!0):w.log("Assigned video stream doesn't contain vidoe track","RaviWebRTCImplementation")}else{const e=this._raviVideoSenders;let t=0;for(;t<e.length;t++)w.log("Setting video sender #"+t+" to null","RaviWebRTCImplementation"),e[t].replaceTrack(null)}return i}_open(e,t){if(w.log("Attempting to open connection...","RaviWebRTCImplementation"),this._customStunAndTurn=t,this._rtcConnection&&("connecting"==this._rtcConnection.connectionState||"connected"==this._rtcConnection.connectionState))return w.log("We already have a connection in progress. Will not attempt a new one.","RaviWebRTCImplementation"),void this._raviSession._handleStateChange({state:this._rtcConnection.connectionState},this._rtcConnection.connectionState);if(this._signalingConnection){this._signalingConnection.addMessageHandler(this._negotiator),this._shortCircuitHandler=this._cancelOpeningProcessOnSignalingDisconnect.bind(this),this._signalingConnection.addStateChangeHandler(this._shortCircuitHandler);let t={};e?(t=e,t.sessionID=this._raviSession.getUUID()):t=this._raviSession.getUUID(),this._signalingConnection.send(JSON.stringify({request:t}))}}_cancelOpeningProcessOnSignalingDisconnect(e){let t=e.state||"unknown";const i=this._raviSession;switch(t){case b.CLOSED:w.log("Signaling state closed before session was established; closing RaviSession","RaviWebRTCImplementation"),i._handleStateChange(e,M.CLOSED),this._close();break;case b.ERROR:w.log("Signaling state errored out before session was established; closing RaviSession","RaviWebRTCImplementation"),i._handleStateChange(e,M.FAILED),this._close();break;case b.UNAVAILABLE:w.log("Signaling state reached 'unavailable' before session was established; closing RaviSession","RaviWebRTCImplementation"),i._handleStateChange(e,M.FAILED),this._close();break;default:w.log("Signaling state has changed during opening of RAVI session, but is an OK change. New state: "+t,"RaviWebRTCImplementation")}}_close(){this._statsWatcher.stop();const e=this._raviSession;w.log("closing","RaviWebRTCImplementation"),this._rtcConnection&&this._rtcConnection.close(),this._signalingConnection.removeMessageHandler(this._negotiator),this._signalingConnection.removeStateChangeHandler(this._shortCircuitHandler),this._rtcConnection=null,e._handleStateChange({},M.CLOSED)}_doOnicecandidate(e){e.candidate&&""!=e.candidate?(w.log("Sending local ICE candidate: "+JSON.stringify(e.candidate),"RaviWebRTCImplementation"),this._signalingConnection.send(JSON.stringify({ice:e.candidate,uuid:this._raviSession.getUUID()}))):w.log("End of local ICE candidates","RaviSession")}_doOnnegotiationneeded(e){w.log("need renegotiation please","RaviWebRTCImplementation");const t={renegotiate:"please",uuid:this._raviSession.getUUID()},i=JSON.stringify(t);this._signalingConnection&&this._rtcConnection&&"stable"===this._rtcConnection.signalingState&&this._signalingConnection.send(i)}_doOnsignalingstatechanged(e){this._rtcConnection&&w.log("SignalingState changed: "+this._rtcConnection.signalingState,"RaviWebRTCImplementation")}_forceBitrateUp(e){const t=this._raviSession._streamController.isStereoInput()?128e3:64e3;return e.replace(/a=fmtp:111 /g,"a=fmtp:111 maxaveragebitrate="+t+";")}_forceStereoDown(e){return e.replace(/a=fmtp:111 /g,"a=fmtp:111 maxaveragebitrate=128000;sprop-stereo=1;stereo=1;")}_setupConnection(e){let t="",i="";const n=this._raviSession,a=this._signalingConnection,s=this;if(n&&a)if(e&&e.data){if(w.log("Message from server: "+e.data,"RaviWebRTCImplementation"),t=JSON.parse(e.data),i=t[n.getUUID()],i)if(i.sdp){if(w.log("Received sdp type="+i.type,"RaviWebRTCImplementation"),s._customStunAndTurn){const e={urls:s._customStunAndTurn.turnUrls,username:s._customStunAndTurn.turnUsername,credential:s._customStunAndTurn.turnCredential},t={urls:s._customStunAndTurn.stunUrls};z={iceServers:[t,e]}}else if(i.turn&&i.turn.urls&&i.turn.username&&i.turn.credential){const e={urls:i.turn.urls,username:i.turn.username,credential:i.turn.credential};z={iceServers:[L,e]}}this._rtcConnection||(this._initRtcConnection(),this._audioInputStream&&this._addAudioInputStream(this._audioInputStream),this._videoInputStream&&this._addVideoInputStream(this._videoInputStream));let e=this._rtcConnection;i.sdp=s._forceBitrateUp(i.sdp);const t=new H(i);e.setRemoteDescription(t).then((function(){return e.createAnswer()})).then((function(t){return t.sdp=s._forceStereoDown(t.sdp),w.log("Answer:","RaviWebRTCImplementation"),w.log(t,"RaviWebRTCImplementation"),e.setLocalDescription(t)})).then((function(){const t={type:"answer",sdp:e.localDescription,uuid:n.getUUID()},i=JSON.stringify(t);w.log("Sending answer to server","RaviWebRTCImplementation"),a.send(i)}))}else i.ice?(w.log("Received remote ICE candidate: "+JSON.stringify(i.ice),"RaviWebRTCImplementation"),this._rtcConnection?this._rtcConnection.addIceCandidate(i.ice).then((function(){w.log("Added remote candidate","RaviWebRTCImplementation")})).catch((function(e){w.err("Error attempting to add remote ICE candidate: "+e.message,"RaviWebRTCImplementation")})):w.log("Ignore ice candidate until we have an rtcConnection, ice='"+JSON.stringify(i)+"'","RaviWebRTCImplementation")):w.log("Unknown message "+JSON.stringify(i),"RaviWebRTCImplementation")}else w.log("No message received by onMessage handler","RaviWebRTCImplementation");else w.err("Missing one of raviSession or signalingConnection! Can't set up connection.","RaviWebRTCImplementation")}_addStatsObserver(e){return this._statsWatcher.addObserver(e)}_removeStatsObserver(e){return this._statsWatcher.removeObserver(e)}_getStats(e=null){return O(this,void 0,void 0,(function*(){return this._rtcConnection?this._rtcConnection.getStats(e):[]}))}}var Q=function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};const V="undefined"!=typeof window,W=e=>{},Z=V?window.localStorage:{getItem:W,setItem:W,removeItem:W},j=V?window.addEventListener:W,$=V?window.removeEventListener:W,K=V?window.document:{visibilityState:!0,addEventListener:W,removeEventListener:W},Y=V?window.navigator:{onLine:!0,userAgent:`NodeJS ${process.report.getReport().header.nodejsVersion}`};let G=V&&window.fetch;if(!V)try{G=i(300)}catch(e){}const J="non-operative";N.set("remote-inbound-rtp",N.get("remote-inbound-rtp").concat(["packetsLost","totalRoundTripTime"])),N.set("inbound-rtp",N.get("inbound-rtp").concat(["packetsLost","packetsReceived","jitter"])),N.set("outbound-rtp",["type","retransmittedPacketsSent","packetsSent"]),N.set("candidate-pair",["writable","state","nominated","localCandidateId","remoteCandidateId"]),N.set("remote-candidate",["id","address","ip","candidateType","protocol"]),N.set("local-candidate",["id","address","ip","candidateType","protocol"]);let q=0,X={},ee={},te={"outbound-rtp":{},"inbound-rtp":{},"remote-inbound-rtp":{}};const ie="directSend";class ne{constructor({url:e="https://webrtc-diag.highfidelity.com/api/v1/logs/post_logs",label:t,session:i,ravi:n,fireOn:a=[]}){Object.assign(this,{url:e,label:t,session:i,ravi:n,fireOn:a}),this.checkPersisted(),this.reset(),this.fireListener=()=>this.fire(),this.onlineListener=()=>this.checkPersisted()}prime(e){this.isPrimed()||(this.checkPersisted(),this.identifier=e,this.grabRTCInternals(),ne.startStats(this.session),this.fireOn.forEach((e=>K.addEventListener(e,this.fireListener))))}fire(){return Q(this,void 0,void 0,(function*(){if(!this.isPrimed())return;const e=this.toString();this.reset(),this.persist(e,"preemptive",!1),(yield this.report(e))?Z.removeItem(this.label):this.persist(e,"failed")}))}noteExplicitApplicationClose(){this.explicitApplicationClose=!0}reset(){ne.stopStats(this.session),this.identifier=J,this.explicitApplicationClose=!1,this.webSocket=this.rtc={},this.fireOn.forEach((e=>K.removeEventListener(e,this.fireListener)))}isPrimed(){return this.identifier!==J}toString(){return`${(new Date).toISOString()} ${this.identifier} `+this.s("logReason","sessionEND")+this.connectionStats("browserStats")+this.connectionStats("mixerStats")+this.rtpStats()+this.rtcStates()+this.s("NUM_CONNECTED",this.session.concurrency,"\n")+this.s("APPSTATE",this.session.getCurrentHiFiConnectionState(),"\n")+this.s("RAVISTATE",this.ravi.getState())+this.s("ONLINE",Y.onLine?"yes":"no")+this.s("XPLICITCLOSED",this.explicitApplicationClose?"yes":"no")+this.visibilityInfo()+this.connectionInfo()+this.s("PERSISTENCE",ie)+` [${Y.userAgent}]`}s(e,t,i=""){let n=isNaN(t)?"_":":";return` ${this.label}${e}${n}${t}`}connectionInfo(){const e=Y.connection||Y.mozConnection||Y.webkitConnection||{};return this.s("DEVICE",e.type,"\n")+this.s("RATING",e.effectiveType)+this.s("DL",e.downlink)+this.s("RTT",e.rtt)}visibilityInfo(){return this.s("VISIBLITY",K.visibilityState)}grabRTCInternals(){let e=this.ravi._raviImplementation,t=e._signalingConnection._signalingImplementation;this.webSocket=t._webSocket,this.rtc=e._rtcConnection}rtcStates(){let e={},t=(t,i=this.rtc)=>{try{e[t]=i[t]}catch(i){e[t]=i.name}};return t("readyState",this.webSocket),["connectionState","signalingState","iceConnectionState","iceGatheringState"].forEach((e=>t(e))),this.s("WebSocket",e.readyState,"\n")+this.s("RTC",e.connectionState)+this.s("SIGNALING",e.signalingState)+this.s("ICE",e.iceConnectionState)+this.s("GATHERING",e.iceGatheringState)}connectionStats(e){let t="browserStats"===e?X:ee;return t?this.s(e+"IP",t.ip||t.address,"\n")+this.s(e+"TYPE",t.candidateType)+this.s(e+"PROTOCOL",t.protocol):""}rtpStats(){let e="";return Object.keys(te).forEach((t=>{let i=te[t],n=!0;Object.keys(i).forEach((a=>{e+=this.s(`${t}_${a}`,i[a],n?"\n":""),n=!1}))})),e}report(e){return!!Y.onLine&&!!G&&(console.log(e),G(this.url,{method:"POST",headers:{"Content-Type":"text/plain"},body:e}).then((e=>e.ok)))}persist(e,t,i=!0){let n=Z.getItem(this.label)||"";n&&(n+="\n"),e=e.replace(ie,t),Z.setItem(this.label,n+e),i&&j("online",this.onlineListener)}checkPersisted(){return Q(this,void 0,void 0,(function*(){$("online",this.onlineListener);let e=Z.getItem(this.label);e&&(yield this.report(e))&&Z.removeItem(this.label)}))}static startStats(e){q++>0||e.startCollectingWebRTCStats(((e,t)=>{let i=e.find((e=>e.writable||e.nominated));if(!i)return;let n=e.find((e=>e.id===i.localCandidateId)),a=e.find((e=>e.id===i.remoteCandidateId));function s(i,n,a=[]){function s(e){return e.find((e=>e.type==i))}let o=s(t),r=s(e);n.forEach((e=>te[i][e]=r&&r[e]-(o?o[e]:0))),a.forEach((e=>te[i][e]=r&&r[e]))}n&&(X=n),a&&(ee=a),s("outbound-rtp",["retransmittedPacketsSent","packetsSent"]),s("inbound-rtp",["packetsLost","packetsReceived"],["jitter"]),s("remote-inbound-rtp",["packetsLost"],["roundTripTime","totalRoundTripTime","jitter"])}))}static stopStats(e){if(q&&!(--q>0)){e.stopCollectingWebRTCStats(),X=ee={};for(let e in te)te[e]={}}}}function ae(e){let t=e.length;for(;--t>=0;)e[t]=0}const se=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),oe=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),re=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),le=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),de=new Array(576);ae(de);const ce=new Array(60);ae(ce);const he=new Array(512);ae(he);const ue=new Array(256);ae(ue);const _e=new Array(29);ae(_e);const me=new Array(30);function ge(e,t,i,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let fe,pe,ve;function Se(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}ae(me);const be=e=>e<256?he[e]:he[256+(e>>>7)],Ce=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},we=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,Ce(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},Ae=(e,t,i)=>{we(e,i[2*t],i[2*t+1])},ye=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},Re=(e,t,i)=>{const n=new Array(16);let a,s,o=0;for(a=1;a<=15;a++)n[a]=o=o+i[a-1]<<1;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=ye(n[t]++,t))}},Te=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Ie=e=>{e.bi_valid>8?Ce(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},xe=(e,t,i,n)=>{const a=2*t,s=2*i;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[i]},De=(e,t,i)=>{const n=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&xe(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!xe(t,n,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=n},ke=(e,t,i)=>{let n,a,s,o,r=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],a=e.pending_buf[e.l_buf+r],r++,0===n?Ae(e,a,t):(s=ue[a],Ae(e,s+256+1,t),o=se[s],0!==o&&(a-=_e[s],we(e,a,o)),n--,s=be(n),Ae(e,s,i),o=oe[s],0!==o&&(n-=me[s],we(e,n,o)))}while(r<e.last_lit);Ae(e,256,t)},Ee=(e,t)=>{const i=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,r,l,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)0!==i[2*o]?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=d<2?++d:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=n[2*l+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)De(e,i,o);l=s;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],De(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=r,i[2*l]=i[2*o]+i[2*r],e.depth[l]=(e.depth[o]>=e.depth[r]?e.depth[o]:e.depth[r])+1,i[2*o+1]=i[2*r+1]=l,e.heap[1]=l++,De(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,r=t.stat_desc.extra_base,l=t.stat_desc.max_length;let d,c,h,u,_,m,g=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(i[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)c=e.heap[d],u=i[2*i[2*c+1]+1]+1,u>l&&(u=l,g++),i[2*c+1]=u,c>n||(e.bl_count[u]++,_=0,c>=r&&(_=o[c-r]),m=i[2*c],e.opt_len+=m*(u+_),s&&(e.static_len+=m*(a[2*c+1]+_)));if(0!==g){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,g-=2}while(g>0);for(u=l;0!==u;u--)for(c=e.bl_count[u];0!==c;)h=e.heap[--d],h>n||(i[2*h+1]!==u&&(e.opt_len+=(u-i[2*h+1])*i[2*h],i[2*h+1]=u),c--)}})(e,t),Re(i,d,e.bl_count)},Me=(e,t,i)=>{let n,a,s=-1,o=t[1],r=0,l=7,d=4;for(0===o&&(l=138,d=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)a=o,o=t[2*(n+1)+1],++r<l&&a===o||(r<d?e.bl_tree[2*a]+=r:0!==a?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):r<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=0,s=a,0===o?(l=138,d=3):a===o?(l=6,d=3):(l=7,d=4))},Oe=(e,t,i)=>{let n,a,s=-1,o=t[1],r=0,l=7,d=4;for(0===o&&(l=138,d=3),n=0;n<=i;n++)if(a=o,o=t[2*(n+1)+1],!(++r<l&&a===o)){if(r<d)do{Ae(e,a,e.bl_tree)}while(0!=--r);else 0!==a?(a!==s&&(Ae(e,a,e.bl_tree),r--),Ae(e,16,e.bl_tree),we(e,r-3,2)):r<=10?(Ae(e,17,e.bl_tree),we(e,r-3,3)):(Ae(e,18,e.bl_tree),we(e,r-11,7));r=0,s=a,0===o?(l=138,d=3):a===o?(l=6,d=3):(l=7,d=4)}};let Pe=!1;const Ne=(e,t,i,n)=>{we(e,0+(n?1:0),3),((e,t,i,n)=>{Ie(e),Ce(e,i),Ce(e,~i),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i})(e,t,i)};var Ue={_tr_init:e=>{Pe||((()=>{let e,t,i,n,a;const s=new Array(16);for(i=0,n=0;n<28;n++)for(_e[n]=i,e=0;e<1<<se[n];e++)ue[i++]=n;for(ue[i-1]=n,a=0,n=0;n<16;n++)for(me[n]=a,e=0;e<1<<oe[n];e++)he[a++]=n;for(a>>=7;n<30;n++)for(me[n]=a<<7,e=0;e<1<<oe[n]-7;e++)he[256+a++]=n;for(t=0;t<=15;t++)s[t]=0;for(e=0;e<=143;)de[2*e+1]=8,e++,s[8]++;for(;e<=255;)de[2*e+1]=9,e++,s[9]++;for(;e<=279;)de[2*e+1]=7,e++,s[7]++;for(;e<=287;)de[2*e+1]=8,e++,s[8]++;for(Re(de,287,s),e=0;e<30;e++)ce[2*e+1]=5,ce[2*e]=ye(e,5);fe=new ge(de,se,257,286,15),pe=new ge(ce,oe,0,30,15),ve=new ge(new Array(0),re,0,19,7)})(),Pe=!0),e.l_desc=new Se(e.dyn_ltree,fe),e.d_desc=new Se(e.dyn_dtree,pe),e.bl_desc=new Se(e.bl_tree,ve),e.bi_buf=0,e.bi_valid=0,Te(e)},_tr_stored_block:Ne,_tr_flush_block:(e,t,i,n)=>{let a,s,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Ee(e,e.l_desc),Ee(e,e.d_desc),o=(e=>{let t;for(Me(e,e.dyn_ltree,e.l_desc.max_code),Me(e,e.dyn_dtree,e.d_desc.max_code),Ee(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*le[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=a&&(a=s)):a=s=i+5,i+4<=a&&-1!==t?Ne(e,t,i,n):4===e.strategy||s===a?(we(e,2+(n?1:0),3),ke(e,de,ce)):(we(e,4+(n?1:0),3),((e,t,i,n)=>{let a;for(we(e,t-257,5),we(e,i-1,5),we(e,n-4,4),a=0;a<n;a++)we(e,e.bl_tree[2*le[a]+1],3);Oe(e,e.dyn_ltree,t-1),Oe(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ke(e,e.dyn_ltree,e.dyn_dtree)),Te(e),n&&Ie(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(ue[i]+256+1)]++,e.dyn_dtree[2*be(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{we(e,2,3),Ae(e,256,de),(e=>{16===e.bi_valid?(Ce(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},Fe=(e,t,i,n)=>{let a=65535&e|0,s=e>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{a=a+t[n++]|0,s=s+a|0}while(--o);a%=65521,s%=65521}return a|s<<16|0};const He=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Le=(e,t,i,n)=>{const a=He,s=n+i;e^=-1;for(let i=n;i<s;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},ze={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Be={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Qe,_tr_stored_block:Ve,_tr_flush_block:We,_tr_tally:Ze,_tr_align:je}=Ue,{Z_NO_FLUSH:$e,Z_PARTIAL_FLUSH:Ke,Z_FULL_FLUSH:Ye,Z_FINISH:Ge,Z_BLOCK:Je,Z_OK:qe,Z_STREAM_END:Xe,Z_STREAM_ERROR:et,Z_DATA_ERROR:tt,Z_BUF_ERROR:it,Z_DEFAULT_COMPRESSION:nt,Z_FILTERED:at,Z_HUFFMAN_ONLY:st,Z_RLE:ot,Z_FIXED:rt,Z_DEFAULT_STRATEGY:lt,Z_UNKNOWN:dt,Z_DEFLATED:ct}=Be,ht=258,ut=262,_t=103,mt=113,gt=666,ft=(e,t)=>(e.msg=ze[t],t),pt=e=>(e<<1)-(e>4?9:0),vt=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let St=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const bt=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},Ct=(e,t)=>{We(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,bt(e.strm)},wt=(e,t)=>{e.pending_buf[e.pending++]=t},At=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},yt=(e,t,i,n)=>{let a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),1===e.state.wrap?e.adler=Fe(e.adler,t,a,i):2===e.state.wrap&&(e.adler=Le(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},Rt=(e,t)=>{let i,n,a=e.max_chain_length,s=e.strstart,o=e.prev_length,r=e.nice_match;const l=e.strstart>e.w_size-ut?e.strstart-(e.w_size-ut):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+ht;let _=d[s+o-1],m=d[s+o];e.prev_length>=e.good_match&&(a>>=2),r>e.lookahead&&(r=e.lookahead);do{if(i=t,d[i+o]===m&&d[i+o-1]===_&&d[i]===d[s]&&d[++i]===d[s+1]){s+=2,i++;do{}while(d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&s<u);if(n=ht-(u-s),s=u-ht,n>o){if(e.match_start=t,o=n,n>=r)break;_=d[s+o-1],m=d[s+o]}}}while((t=h[t&c])>l&&0!=--a);return o<=e.lookahead?o:e.lookahead},Tt=e=>{const t=e.w_size;let i,n,a,s,o;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ut)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,n=e.hash_size,i=n;do{a=e.head[--i],e.head[i]=a>=t?a-t:0}while(--n);n=t,i=n;do{a=e.prev[--i],e.prev[i]=a>=t?a-t:0}while(--n);s+=t}if(0===e.strm.avail_in)break;if(n=yt(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=St(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=St(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ut&&0!==e.strm.avail_in)},It=(e,t)=>{let i,n;for(;;){if(e.lookahead<ut){if(Tt(e),e.lookahead<ut&&t===$e)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ut&&(e.match_length=Rt(e,i)),e.match_length>=3)if(n=Ze(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=St(e,e.ins_h,e.window[e.strstart+1]);else n=Ze(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Ct(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ge?(Ct(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ct(e,!1),0===e.strm.avail_out)?1:2},xt=(e,t)=>{let i,n,a;for(;;){if(e.lookahead<ut){if(Tt(e),e.lookahead<ut&&t===$e)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ut&&(e.match_length=Rt(e,i),e.match_length<=5&&(e.strategy===at||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=Ze(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Ct(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Ze(e,0,e.window[e.strstart-1]),n&&Ct(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Ze(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ge?(Ct(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ct(e,!1),0===e.strm.avail_out)?1:2};function Dt(e,t,i,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=a}const kt=[new Dt(0,0,0,0,((e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Tt(e),0===e.lookahead&&t===$e)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,Ct(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-ut&&(Ct(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ge?(Ct(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Ct(e,!1),e.strm.avail_out),1)})),new Dt(4,4,8,4,It),new Dt(4,5,16,8,It),new Dt(4,6,32,32,It),new Dt(4,4,16,16,xt),new Dt(8,16,32,32,xt),new Dt(8,16,128,128,xt),new Dt(8,32,128,256,xt),new Dt(32,128,258,1024,xt),new Dt(32,258,258,4096,xt)];function Et(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ct,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),vt(this.dyn_ltree),vt(this.dyn_dtree),vt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),vt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),vt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Mt=e=>{if(!e||!e.state)return ft(e,et);e.total_in=e.total_out=0,e.data_type=dt;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:mt,e.adler=2===t.wrap?0:1,t.last_flush=$e,Qe(t),qe},Ot=e=>{const t=Mt(e);var i;return t===qe&&((i=e.state).window_size=2*i.w_size,vt(i.head),i.max_lazy_match=kt[i.level].max_lazy,i.good_match=kt[i.level].good_length,i.nice_match=kt[i.level].nice_length,i.max_chain_length=kt[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},Pt=(e,t,i,n,a,s)=>{if(!e)return et;let o=1;if(t===nt&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>9||i!==ct||n<8||n>15||t<0||t>9||s<0||s>rt)return ft(e,et);8===n&&(n=9);const r=new Et;return e.state=r,r.strm=e,r.wrap=o,r.gzhead=null,r.w_bits=n,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=a+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Uint8Array(2*r.w_size),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<a+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Uint8Array(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=t,r.strategy=s,r.method=i,Ot(e)};var Nt=Pt,Ut=(e,t)=>e&&e.state?2!==e.state.wrap?et:(e.state.gzhead=t,qe):et,Ft=(e,t)=>{let i,n;if(!e||!e.state||t>Je||t<0)return e?ft(e,et):et;const a=e.state;if(!e.output||!e.input&&0!==e.avail_in||a.status===gt&&t!==Ge)return ft(e,0===e.avail_out?it:et);a.strm=e;const s=a.last_flush;if(a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,wt(a,31),wt(a,139),wt(a,8),a.gzhead?(wt(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),wt(a,255&a.gzhead.time),wt(a,a.gzhead.time>>8&255),wt(a,a.gzhead.time>>16&255),wt(a,a.gzhead.time>>24&255),wt(a,9===a.level?2:a.strategy>=st||a.level<2?4:0),wt(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(wt(a,255&a.gzhead.extra.length),wt(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=Le(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,0),wt(a,9===a.level?2:a.strategy>=st||a.level<2?4:0),wt(a,3),a.status=mt);else{let t=ct+(a.w_bits-8<<4)<<8,i=-1;i=a.strategy>=st||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,a.status=mt,At(a,t),0!==a.strstart&&(At(a,e.adler>>>16),At(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(i=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>i&&(e.adler=Le(e.adler,a.pending_buf,a.pending-i,i)),bt(e),i=a.pending,a.pending!==a.pending_buf_size));)wt(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>i&&(e.adler=Le(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=Le(e.adler,a.pending_buf,a.pending-i,i)),bt(e),i=a.pending,a.pending===a.pending_buf_size)){n=1;break}n=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,wt(a,n)}while(0!==n);a.gzhead.hcrc&&a.pending>i&&(e.adler=Le(e.adler,a.pending_buf,a.pending-i,i)),0===n&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=Le(e.adler,a.pending_buf,a.pending-i,i)),bt(e),i=a.pending,a.pending===a.pending_buf_size)){n=1;break}n=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,wt(a,n)}while(0!==n);a.gzhead.hcrc&&a.pending>i&&(e.adler=Le(e.adler,a.pending_buf,a.pending-i,i)),0===n&&(a.status=_t)}else a.status=_t;if(a.status===_t&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&bt(e),a.pending+2<=a.pending_buf_size&&(wt(a,255&e.adler),wt(a,e.adler>>8&255),e.adler=0,a.status=mt)):a.status=mt),0!==a.pending){if(bt(e),0===e.avail_out)return a.last_flush=-1,qe}else if(0===e.avail_in&&pt(t)<=pt(s)&&t!==Ge)return ft(e,it);if(a.status===gt&&0!==e.avail_in)return ft(e,it);if(0!==e.avail_in||0!==a.lookahead||t!==$e&&a.status!==gt){let i=a.strategy===st?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(Tt(e),0===e.lookahead)){if(t===$e)return 1;break}if(e.match_length=0,i=Ze(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(Ct(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ge?(Ct(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ct(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===ot?((e,t)=>{let i,n,a,s;const o=e.window;for(;;){if(e.lookahead<=ht){if(Tt(e),e.lookahead<=ht&&t===$e)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,n=o[a],n===o[++a]&&n===o[++a]&&n===o[++a])){s=e.strstart+ht;do{}while(n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&n===o[++a]&&a<s);e.match_length=ht-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=Ze(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Ze(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(Ct(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ge?(Ct(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ct(e,!1),0===e.strm.avail_out)?1:2})(a,t):kt[a.level].func(a,t);if(3!==i&&4!==i||(a.status=gt),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),qe;if(2===i&&(t===Ke?je(a):t!==Je&&(Ve(a,0,0,!1),t===Ye&&(vt(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),bt(e),0===e.avail_out))return a.last_flush=-1,qe}return t!==Ge?qe:a.wrap<=0?Xe:(2===a.wrap?(wt(a,255&e.adler),wt(a,e.adler>>8&255),wt(a,e.adler>>16&255),wt(a,e.adler>>24&255),wt(a,255&e.total_in),wt(a,e.total_in>>8&255),wt(a,e.total_in>>16&255),wt(a,e.total_in>>24&255)):(At(a,e.adler>>>16),At(a,65535&e.adler)),bt(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?qe:Xe)},Ht=e=>{if(!e||!e.state)return et;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==_t&&t!==mt&&t!==gt?ft(e,et):(e.state=null,t===mt?ft(e,tt):qe)},Lt=(e,t)=>{let i=t.length;if(!e||!e.state)return et;const n=e.state,a=n.wrap;if(2===a||1===a&&42!==n.status||n.lookahead)return et;if(1===a&&(e.adler=Fe(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){0===a&&(vt(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(i-n.w_size,i),0),t=e,i=n.w_size}const s=e.avail_in,o=e.next_in,r=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Tt(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=St(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Tt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=r,e.avail_in=s,n.wrap=a,qe};const zt=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Bt=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)zt(i,t)&&(e[t]=i[t])}}return e},Qt=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,a=e.length;t<a;t++){let a=e[t];i.set(a,n),n+=a.length}return i};let Vt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Vt=!1}const Wt=new Uint8Array(256);for(let e=0;e<256;e++)Wt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Wt[254]=Wt[254]=1;var Zt=e=>{let t,i,n,a,s,o=e.length,r=0;for(a=0;a<o;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),r+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(r),s=0,a=0;s<r;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},jt=(e,t)=>{let i,n;const a=t||e.length,s=new Array(2*a);for(n=0,i=0;i<a;){let t=e[i++];if(t<128){s[n++]=t;continue}let o=Wt[t];if(o>4)s[n++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<a;)t=t<<6|63&e[i++],o--;o>1?s[n++]=65533:t<65536?s[n++]=t:(t-=65536,s[n++]=55296|t>>10&1023,s[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Vt)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i})(s,n)},$t=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Wt[e[i]]>t?i:t},Kt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Yt=Object.prototype.toString,{Z_NO_FLUSH:Gt,Z_SYNC_FLUSH:Jt,Z_FULL_FLUSH:qt,Z_FINISH:Xt,Z_OK:ei,Z_STREAM_END:ti,Z_DEFAULT_COMPRESSION:ii,Z_DEFAULT_STRATEGY:ni,Z_DEFLATED:ai}=Be;function si(e){this.options=Bt({level:ii,method:ai,chunkSize:16384,windowBits:15,memLevel:8,strategy:ni},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Kt,this.strm.avail_out=0;let i=Nt(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==ei)throw new Error(ze[i]);if(t.header&&Ut(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Zt(t.dictionary):"[object ArrayBuffer]"===Yt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=Lt(this.strm,e),i!==ei)throw new Error(ze[i]);this._dict_set=!0}}function oi(e,t){const i=new si(t);if(i.push(e,!0),i.err)throw i.msg||ze[i.err];return i.result}si.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize;let a,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Xt:Gt,"string"==typeof e?i.input=Zt(e):"[object ArrayBuffer]"===Yt.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(s===Jt||s===qt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=Ft(i,s),a===ti)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=Ht(this.strm),this.onEnd(a),this.ended=!0,a===ei;if(0!==i.avail_out){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},si.prototype.onData=function(e){this.chunks.push(e)},si.prototype.onEnd=function(e){e===ei&&(this.result=Qt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ri={Deflate:si,deflate:oi,deflateRaw:function(e,t){return(t=t||{}).raw=!0,oi(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,oi(e,t)},constants:Be},li=function(e,t){let i,n,a,s,o,r,l,d,c,h,u,_,m,g,f,p,v,S,b,C,w,A,y,R;const T=e.state;i=e.next_in,y=e.input,n=i+(e.avail_in-5),a=e.next_out,R=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),r=T.dmax,l=T.wsize,d=T.whave,c=T.wnext,h=T.window,u=T.hold,_=T.bits,m=T.lencode,g=T.distcode,f=(1<<T.lenbits)-1,p=(1<<T.distbits)-1;e:do{_<15&&(u+=y[i++]<<_,_+=8,u+=y[i++]<<_,_+=8),v=m[u&f];t:for(;;){if(S=v>>>24,u>>>=S,_-=S,S=v>>>16&255,0===S)R[a++]=65535&v;else{if(!(16&S)){if(0==(64&S)){v=m[(65535&v)+(u&(1<<S)-1)];continue t}if(32&S){T.mode=12;break e}e.msg="invalid literal/length code",T.mode=30;break e}b=65535&v,S&=15,S&&(_<S&&(u+=y[i++]<<_,_+=8),b+=u&(1<<S)-1,u>>>=S,_-=S),_<15&&(u+=y[i++]<<_,_+=8,u+=y[i++]<<_,_+=8),v=g[u&p];i:for(;;){if(S=v>>>24,u>>>=S,_-=S,S=v>>>16&255,!(16&S)){if(0==(64&S)){v=g[(65535&v)+(u&(1<<S)-1)];continue i}e.msg="invalid distance code",T.mode=30;break e}if(C=65535&v,S&=15,_<S&&(u+=y[i++]<<_,_+=8,_<S&&(u+=y[i++]<<_,_+=8)),C+=u&(1<<S)-1,C>r){e.msg="invalid distance too far back",T.mode=30;break e}if(u>>>=S,_-=S,S=a-s,C>S){if(S=C-S,S>d&&T.sane){e.msg="invalid distance too far back",T.mode=30;break e}if(w=0,A=h,0===c){if(w+=l-S,S<b){b-=S;do{R[a++]=h[w++]}while(--S);w=a-C,A=R}}else if(c<S){if(w+=l+c-S,S-=c,S<b){b-=S;do{R[a++]=h[w++]}while(--S);if(w=0,c<b){S=c,b-=S;do{R[a++]=h[w++]}while(--S);w=a-C,A=R}}}else if(w+=c-S,S<b){b-=S;do{R[a++]=h[w++]}while(--S);w=a-C,A=R}for(;b>2;)R[a++]=A[w++],R[a++]=A[w++],R[a++]=A[w++],b-=3;b&&(R[a++]=A[w++],b>1&&(R[a++]=A[w++]))}else{w=a-C;do{R[a++]=R[w++],R[a++]=R[w++],R[a++]=R[w++],b-=3}while(b>2);b&&(R[a++]=R[w++],b>1&&(R[a++]=R[w++]))}break}}break}}while(i<n&&a<o);b=_>>3,i-=b,_-=b<<3,u&=(1<<_)-1,e.next_in=i,e.next_out=a,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=a<o?o-a+257:257-(a-o),T.hold=u,T.bits=_};const di=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ci=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hi=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ui=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _i=(e,t,i,n,a,s,o,r)=>{const l=r.bits;let d,c,h,u,_,m,g=0,f=0,p=0,v=0,S=0,b=0,C=0,w=0,A=0,y=0,R=null,T=0;const I=new Uint16Array(16),x=new Uint16Array(16);let D,k,E,M=null,O=0;for(g=0;g<=15;g++)I[g]=0;for(f=0;f<n;f++)I[t[i+f]]++;for(S=l,v=15;v>=1&&0===I[v];v--);if(S>v&&(S=v),0===v)return a[s++]=20971520,a[s++]=20971520,r.bits=1,0;for(p=1;p<v&&0===I[p];p++);for(S<p&&(S=p),w=1,g=1;g<=15;g++)if(w<<=1,w-=I[g],w<0)return-1;if(w>0&&(0===e||1!==v))return-1;for(x[1]=0,g=1;g<15;g++)x[g+1]=x[g]+I[g];for(f=0;f<n;f++)0!==t[i+f]&&(o[x[t[i+f]]++]=f);if(0===e?(R=M=o,m=19):1===e?(R=di,T-=257,M=ci,O-=257,m=256):(R=hi,M=ui,m=-1),y=0,f=0,g=p,_=s,b=S,C=0,h=-1,A=1<<S,u=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){D=g-C,o[f]<m?(k=0,E=o[f]):o[f]>m?(k=M[O+o[f]],E=R[T+o[f]]):(k=96,E=0),d=1<<g-C,c=1<<b,p=c;do{c-=d,a[_+(y>>C)+c]=D<<24|k<<16|E|0}while(0!==c);for(d=1<<g-1;y&d;)d>>=1;if(0!==d?(y&=d-1,y+=d):y=0,f++,0==--I[g]){if(g===v)break;g=t[i+o[f]]}if(g>S&&(y&u)!==h){for(0===C&&(C=S),_+=p,b=g-C,w=1<<b;b+C<v&&(w-=I[b+C],!(w<=0));)b++,w<<=1;if(A+=1<<b,1===e&&A>852||2===e&&A>592)return 1;h=y&u,a[h]=S<<24|b<<16|_-s|0}}return 0!==y&&(a[_+y]=g-C<<24|64<<16|0),r.bits=S,0};const{Z_FINISH:mi,Z_BLOCK:gi,Z_TREES:fi,Z_OK:pi,Z_STREAM_END:vi,Z_NEED_DICT:Si,Z_STREAM_ERROR:bi,Z_DATA_ERROR:Ci,Z_MEM_ERROR:wi,Z_BUF_ERROR:Ai,Z_DEFLATED:yi}=Be,Ri=12,Ti=30,Ii=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function xi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Di=e=>{if(!e||!e.state)return bi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,pi},ki=e=>{if(!e||!e.state)return bi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Di(e)},Ei=(e,t)=>{let i;if(!e||!e.state)return bi;const n=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?bi:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,ki(e))},Mi=(e,t)=>{if(!e)return bi;const i=new xi;e.state=i,i.window=null;const n=Ei(e,t);return n!==pi&&(e.state=null),n};let Oi,Pi,Ni=!0;const Ui=e=>{if(Ni){Oi=new Int32Array(512),Pi=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_i(1,e.lens,0,288,Oi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_i(2,e.lens,0,32,Pi,0,e.work,{bits:5}),Ni=!1}e.lencode=Oi,e.lenbits=9,e.distcode=Pi,e.distbits=5},Fi=(e,t,i,n)=>{let a;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(i-n,i-n+a),s.wnext),(n-=a)?(s.window.set(t.subarray(i-n,i),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0};var Hi=ki,Li=Mi,zi=(e,t)=>{let i,n,a,s,o,r,l,d,c,h,u,_,m,g,f,p,v,S,b,C,w,A,y=0;const R=new Uint8Array(4);let T,I;const x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return bi;i=e.state,i.mode===Ri&&(i.mode=13),o=e.next_out,a=e.output,l=e.avail_out,s=e.next_in,n=e.input,r=e.avail_in,d=i.hold,c=i.bits,h=r,u=l,A=pi;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;c<16;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(2&i.wrap&&35615===d){i.check=0,R[0]=255&d,R[1]=d>>>8&255,i.check=Le(i.check,R,2,0),d=0,c=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",i.mode=Ti;break}if((15&d)!==yi){e.msg="unknown compression method",i.mode=Ti;break}if(d>>>=4,c-=4,w=8+(15&d),0===i.wbits)i.wbits=w;else if(w>i.wbits){e.msg="invalid window size",i.mode=Ti;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&d?10:Ri,d=0,c=0;break;case 2:for(;c<16;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(i.flags=d,(255&i.flags)!==yi){e.msg="unknown compression method",i.mode=Ti;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Ti;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&(R[0]=255&d,R[1]=d>>>8&255,i.check=Le(i.check,R,2,0)),d=0,c=0,i.mode=3;case 3:for(;c<32;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}i.head&&(i.head.time=d),512&i.flags&&(R[0]=255&d,R[1]=d>>>8&255,R[2]=d>>>16&255,R[3]=d>>>24&255,i.check=Le(i.check,R,4,0)),d=0,c=0,i.mode=4;case 4:for(;c<16;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&(R[0]=255&d,R[1]=d>>>8&255,i.check=Le(i.check,R,2,0)),d=0,c=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&(R[0]=255&d,R[1]=d>>>8&255,i.check=Le(i.check,R,2,0)),d=0,c=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(_=i.length,_>r&&(_=r),_&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(s,s+_),w)),512&i.flags&&(i.check=Le(i.check,n,_,s)),r-=_,s+=_,i.length-=_),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===r)break e;_=0;do{w=n[s+_++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&_<r);if(512&i.flags&&(i.check=Le(i.check,n,_,s)),r-=_,s+=_,w)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===r)break e;_=0;do{w=n[s+_++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&_<r);if(512&i.flags&&(i.check=Le(i.check,n,_,s)),r-=_,s+=_,w)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(d!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Ti;break}d=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Ri;break;case 10:for(;c<32;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}e.adler=i.check=Ii(d),d=0,c=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=r,i.hold=d,i.bits=c,Si;e.adler=i.check=1,i.mode=Ri;case Ri:if(t===gi||t===fi)break e;case 13:if(i.last){d>>>=7&c,c-=7&c,i.mode=27;break}for(;c<3;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}switch(i.last=1&d,d>>>=1,c-=1,3&d){case 0:i.mode=14;break;case 1:if(Ui(i),i.mode=20,t===fi){d>>>=2,c-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=Ti}d>>>=2,c-=2;break;case 14:for(d>>>=7&c,c-=7&c;c<32;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Ti;break}if(i.length=65535&d,d=0,c=0,i.mode=15,t===fi)break e;case 15:i.mode=16;case 16:if(_=i.length,_){if(_>r&&(_=r),_>l&&(_=l),0===_)break e;a.set(n.subarray(s,s+_),o),r-=_,s+=_,l-=_,o+=_,i.length-=_;break}i.mode=Ri;break;case 17:for(;c<14;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(i.nlen=257+(31&d),d>>>=5,c-=5,i.ndist=1+(31&d),d>>>=5,c-=5,i.ncode=4+(15&d),d>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Ti;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}i.lens[x[i.have++]]=7&d,d>>>=3,c-=3}for(;i.have<19;)i.lens[x[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,T={bits:i.lenbits},A=_i(0,i.lens,0,19,i.lencode,0,i.work,T),i.lenbits=T.bits,A){e.msg="invalid code lengths set",i.mode=Ti;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;y=i.lencode[d&(1<<i.lenbits)-1],f=y>>>24,p=y>>>16&255,v=65535&y,!(f<=c);){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(v<16)d>>>=f,c-=f,i.lens[i.have++]=v;else{if(16===v){for(I=f+2;c<I;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(d>>>=f,c-=f,0===i.have){e.msg="invalid bit length repeat",i.mode=Ti;break}w=i.lens[i.have-1],_=3+(3&d),d>>>=2,c-=2}else if(17===v){for(I=f+3;c<I;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}d>>>=f,c-=f,w=0,_=3+(7&d),d>>>=3,c-=3}else{for(I=f+7;c<I;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}d>>>=f,c-=f,w=0,_=11+(127&d),d>>>=7,c-=7}if(i.have+_>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Ti;break}for(;_--;)i.lens[i.have++]=w}}if(i.mode===Ti)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Ti;break}if(i.lenbits=9,T={bits:i.lenbits},A=_i(1,i.lens,0,i.nlen,i.lencode,0,i.work,T),i.lenbits=T.bits,A){e.msg="invalid literal/lengths set",i.mode=Ti;break}if(i.distbits=6,i.distcode=i.distdyn,T={bits:i.distbits},A=_i(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,T),i.distbits=T.bits,A){e.msg="invalid distances set",i.mode=Ti;break}if(i.mode=20,t===fi)break e;case 20:i.mode=21;case 21:if(r>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=r,i.hold=d,i.bits=c,li(e,u),o=e.next_out,a=e.output,l=e.avail_out,s=e.next_in,n=e.input,r=e.avail_in,d=i.hold,c=i.bits,i.mode===Ri&&(i.back=-1);break}for(i.back=0;y=i.lencode[d&(1<<i.lenbits)-1],f=y>>>24,p=y>>>16&255,v=65535&y,!(f<=c);){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(p&&0==(240&p)){for(S=f,b=p,C=v;y=i.lencode[C+((d&(1<<S+b)-1)>>S)],f=y>>>24,p=y>>>16&255,v=65535&y,!(S+f<=c);){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}d>>>=S,c-=S,i.back+=S}if(d>>>=f,c-=f,i.back+=f,i.length=v,0===p){i.mode=26;break}if(32&p){i.back=-1,i.mode=Ri;break}if(64&p){e.msg="invalid literal/length code",i.mode=Ti;break}i.extra=15&p,i.mode=22;case 22:if(i.extra){for(I=i.extra;c<I;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;y=i.distcode[d&(1<<i.distbits)-1],f=y>>>24,p=y>>>16&255,v=65535&y,!(f<=c);){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(0==(240&p)){for(S=f,b=p,C=v;y=i.distcode[C+((d&(1<<S+b)-1)>>S)],f=y>>>24,p=y>>>16&255,v=65535&y,!(S+f<=c);){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}d>>>=S,c-=S,i.back+=S}if(d>>>=f,c-=f,i.back+=f,64&p){e.msg="invalid distance code",i.mode=Ti;break}i.offset=v,i.extra=15&p,i.mode=24;case 24:if(i.extra){for(I=i.extra;c<I;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Ti;break}i.mode=25;case 25:if(0===l)break e;if(_=u-l,i.offset>_){if(_=i.offset-_,_>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Ti;break}_>i.wnext?(_-=i.wnext,m=i.wsize-_):m=i.wnext-_,_>i.length&&(_=i.length),g=i.window}else g=a,m=o-i.offset,_=i.length;_>l&&(_=l),l-=_,i.length-=_;do{a[o++]=g[m++]}while(--_);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;a[o++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===r)break e;r--,d|=n[s++]<<c,c+=8}if(u-=l,e.total_out+=u,i.total+=u,u&&(e.adler=i.check=i.flags?Le(i.check,a,u,o-u):Fe(i.check,a,u,o-u)),u=l,(i.flags?d:Ii(d))!==i.check){e.msg="incorrect data check",i.mode=Ti;break}d=0,c=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===r)break e;r--,d+=n[s++]<<c,c+=8}if(d!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Ti;break}d=0,c=0}i.mode=29;case 29:A=vi;break e;case Ti:A=Ci;break e;case 31:return wi;case 32:default:return bi}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=r,i.hold=d,i.bits=c,(i.wsize||u!==e.avail_out&&i.mode<Ti&&(i.mode<27||t!==mi))&&Fi(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,i.total+=u,i.wrap&&u&&(e.adler=i.check=i.flags?Le(i.check,a,u,e.next_out-u):Fe(i.check,a,u,e.next_out-u)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Ri?128:0)+(20===i.mode||15===i.mode?256:0),(0===h&&0===u||t===mi)&&A===pi&&(A=Ai),A},Bi=e=>{if(!e||!e.state)return bi;let t=e.state;return t.window&&(t.window=null),e.state=null,pi},Qi=(e,t)=>{if(!e||!e.state)return bi;const i=e.state;return 0==(2&i.wrap)?bi:(i.head=t,t.done=!1,pi)},Vi=(e,t)=>{const i=t.length;let n,a,s;return e&&e.state?(n=e.state,0!==n.wrap&&11!==n.mode?bi:11===n.mode&&(a=1,a=Fe(a,t,i,0),a!==n.check)?Ci:(s=Fi(e,t,i,i),s?(n.mode=31,wi):(n.havedict=1,pi))):bi},Wi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Zi=Object.prototype.toString,{Z_NO_FLUSH:ji,Z_FINISH:$i,Z_OK:Ki,Z_STREAM_END:Yi,Z_NEED_DICT:Gi,Z_STREAM_ERROR:Ji,Z_DATA_ERROR:qi,Z_MEM_ERROR:Xi}=Be;function en(e){this.options=Bt({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Kt,this.strm.avail_out=0;let i=Li(this.strm,t.windowBits);if(i!==Ki)throw new Error(ze[i]);if(this.header=new Wi,Qi(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Zt(t.dictionary):"[object ArrayBuffer]"===Zi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Vi(this.strm,t.dictionary),i!==Ki)))throw new Error(ze[i])}function tn(e,t){const i=new en(t);if(i.push(e),i.err)throw i.msg||ze[i.err];return i.result}en.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let s,o,r;if(this.ended)return!1;for(o=t===~~t?t:!0===t?$i:ji,"[object ArrayBuffer]"===Zi.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),s=zi(i,o),s===Gi&&a&&(s=Vi(i,a),s===Ki?s=zi(i,o):s===qi&&(s=Gi));i.avail_in>0&&s===Yi&&i.state.wrap>0&&0!==e[i.next_in];)Hi(i),s=zi(i,o);switch(s){case Ji:case qi:case Gi:case Xi:return this.onEnd(s),this.ended=!0,!1}if(r=i.avail_out,i.next_out&&(0===i.avail_out||s===Yi))if("string"===this.options.to){let e=$t(i.output,i.next_out),t=i.next_out-e,a=jt(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(a)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==Ki||0!==r){if(s===Yi)return s=Bi(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},en.prototype.onData=function(e){this.chunks.push(e)},en.prototype.onEnd=function(e){e===Ki&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Qt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nn={Inflate:en,inflate:tn,inflateRaw:function(e,t){return(t=t||{}).raw=!0,tn(e,t)},ungzip:tn,constants:Be};const{Deflate:an,deflate:sn,deflateRaw:on,gzip:rn}=ri,{Inflate:ln,inflate:dn,inflateRaw:cn,ungzip:hn}=nn,un={Deflate:an,deflate:sn,deflateRaw:on,gzip:rn,Inflate:ln,inflate:dn,inflateRaw:cn,ungzip:hn,constants:Be};var _n=function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};const mn="undefined"!=typeof window;let gn=mn&&window.MediaStream;if(!mn)try{gn=i(326).cL}catch(e){}var fn,pn;!function(e){e.CLIENT="client",e.ADMIN="admin",e.INTERNAL="internal"}(fn||(fn={}));class vn{constructor({success:e,targetInputAudioMutedValue:t,currentInputAudioMutedValue:i,adminPreventsInputAudioUnmuting:n,muteReason:a}){this.success=e,this.targetInputAudioMutedValue=t,this.currentInputAudioMutedValue=i,this.adminPreventsInputAudioUnmuting=n,this.muteReason=a}}class Sn{constructor({userDataStreamingScope:e=wn.All,onUserDataUpdated:t,onUsersDisconnected:i,onConnectionStateChanged:n,onMuteChanged:a,getUserFacingConnectionState:s}){this.concurrency=0,this.onRAVISignalingStateChanged=function(e){return _n(this,void 0,void 0,(function*(){switch(f.M.log(`New RAVI signaling state: \`${e.state}\``),e.state){case b.UNAVAILABLE:this._disableReconnect=!0,this._onConnectionStateChange(Cn.Unavailable,{success:!1,error:"High Fidelity server is at capacity; service is unavailable.",disableReconnect:this._disableReconnect});try{yield this._disconnectFromHiFiMixer()}catch(e){f.M.log(`Error encountered while trying to close the connection. Error:\n${w.safelyPrintable(e)}`)}}}))}.bind(this),this.onRAVISessionStateChanged=function(e){return _n(this,void 0,void 0,(function*(){let t;switch(f.M.log(`New RAVI session state: \`${e.state}\``),this._raviDiagnostics.fire(),e.state){case M.CONNECTED:f.M.log("RaviSession connected; waiting for results of audionet.init"),this._copyAudioTracksFromRavi();break;case M.CLOSED:t="RaviSession has been closed; connection to High Fidelity servers has been disconnected",this._onConnectionStateChange(Cn.Disconnected,{success:!0,error:t,disableReconnect:this._disableReconnect});break;case M.DISCONNECTED:case M.FAILED:t="RaviSession has disconnected unexpectedly",this._onConnectionStateChange(Cn.Failed,{success:!1,error:t,disableReconnect:this._disableReconnect});try{yield this._disconnectFromHiFiMixer()}catch(e){f.M.log(`Error encountered while trying to close the connection. Error:\n${w.safelyPrintable(e)}`)}}}))}.bind(this),this.webRTCAddress=void 0,this.userDataStreamingScope=e,this.onUserDataUpdated=t,this.onUsersDisconnected=i,this._mixerPeerKeyToStateCacheDict={},this._lastSuccessfulInputAudioMutedValue=!1,this.onMuteChanged=a,this._getUserFacingConnectionState=s,this._disableReconnect=!1,w.setDebug(!1),this._raviSignalingConnection=new A,this._raviSession=new P,this._raviSession.getCommandController().addBinaryHandler((e=>{this.handleRAVISessionBinaryData(e)}),!0),this.onConnectionStateChanged=n,this._outputAudioMediaStream=new gn,this._tryingToConnect=!1,this._resetMixerInfo(),this._raviDiagnostics=new ne({label:"ravi",session:this,ravi:this._raviSession}),this._hifiDiagnostics=new ne({label:"app",session:this,ravi:this._raviSession,fireOn:["visibilitychange","pagehide","beforeunload"]})}promiseToRunAudioInit(e){return _n(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{let n={primary:!0,visit_id:this._raviSession.getUUID(),session:this._raviSession.getUUID(),streaming_scope:this.userDataStreamingScope,is_input_stream_stereo:this._inputAudioMediaStreamIsStereo};if(e){let t=this._getDataToTransmitToMixer(e);n=Object.assign(Object.assign({},n),t)}let a=this._raviSession.getCommandController();if(!a)return i({success:!1,error:"Couldn't connect to mixer: no `commandController`!"});let s=setTimeout((()=>_n(this,void 0,void 0,(function*(){return i({success:!1,error:"Couldn't connect to mixer: Call to `init` timed out!",disableReconnect:this._disableReconnect})}))),5e3);a.queueCommand("audionet.init",n,(e=>_n(this,void 0,void 0,(function*(){let n;clearTimeout(s);try{return n=JSON.parse(e),this.mixerInfo.connected=!0,this.mixerInfo.build_number=n.build_number,this.mixerInfo.build_type=n.build_type,this.mixerInfo.build_version=n.build_version,this.mixerInfo.visit_id_hash=n.visit_id_hash,t({success:!0,audionetInitResponse:n,disableReconnect:this._disableReconnect})}catch(e){return i({success:!1,error:`Couldn't parse init response! Parse error:\n${e}`,disableReconnect:this._disableReconnect})}}))))}))}))}handleRAVISessionBinaryData(e){let t=un.ungzip(e,{to:"string"}),i=JSON.parse(t);if(i.deleted_visit_ids){let e=[],t=i.deleted_visit_ids;for(const i of t){let t=i,n=new u({hashedVisitID:t}),a=Object.keys(this._mixerPeerKeyToStateCacheDict);for(const e of a)if(this._mixerPeerKeyToStateCacheDict[e].hashedVisitID===t){this._mixerPeerKeyToStateCacheDict[e].providedUserID&&(n.providedUserID=this._mixerPeerKeyToStateCacheDict[e].providedUserID);break}e.push(n)}this.concurrency-=e.length,this.onUsersDisconnected&&e.length>0&&this.onUsersDisconnected(e)}if(i.peers){let e=[],t=Object.keys(i.peers);for(let n=0;n<t.length;n++){let a,r=i.peers[t[n]];this._mixerPeerKeyToStateCacheDict[t[n]]?a=this._mixerPeerKeyToStateCacheDict[t[n]]:(a=new u,this._mixerPeerKeyToStateCacheDict[t[n]]=a,this.concurrency+=1);let l=new u;a.providedUserID?l.providedUserID=a.providedUserID:"string"==typeof r.J&&(a.providedUserID=r.J,l.providedUserID=r.J),a.hashedVisitID?l.hashedVisitID=a.hashedVisitID:"string"==typeof r.e&&(a.hashedVisitID=r.e,l.hashedVisitID=r.e);let d=!1,c=!1;"number"==typeof r.x&&(a.position||(a.position=new s),a.position.x=r.x/1e3,c=!0),"number"==typeof r.y&&(a.position||(a.position=new s),a.position.y=r.y/1e3,c=!0),"number"==typeof r.z&&(a.position||(a.position=new s),a.position.z=r.z/1e3,c=!0),c&&(l.position=S.translatePoint3DFromMixerSpace(v,a.position),d=!0);let h=!1;"number"==typeof r.W&&(a.orientationQuat||(a.orientationQuat=new o),a.orientationQuat.w=r.W/1e3,h=!0),"number"==typeof r.X&&(a.orientationQuat||(a.orientationQuat=new o),a.orientationQuat.x=r.X/1e3,h=!0),"number"==typeof r.Y&&(a.orientationQuat||(a.orientationQuat=new o),a.orientationQuat.y=r.Y/1e3,h=!0),"number"==typeof r.Z&&(a.orientationQuat||(a.orientationQuat=new o),a.orientationQuat.z=r.Z/1e3,h=!0),h&&(l.orientationQuat=S.translateOrientationQuat3DFromMixerSpace(v,a.orientationQuat),d=!0),"number"==typeof r.v&&(a.volumeDecibels=r.v,l.volumeDecibels=r.v,d=!0),"boolean"==typeof r.s&&(a.isStereo=r.s,l.isStereo=r.s,d=!0),d&&e.push(l)}this.onUserDataUpdated&&e.length>0&&this.onUserDataUpdated(e)}if(i.instructions)for(const e of i.instructions){if(!Array.isArray(e)||!e.length)continue;let t=e[0],i=e.slice(1);if("mute"===t){let e;i.length>=1&&"boolean"==typeof i[0]&&(e=i[0]),void 0!==e&&this._setMutedByAdmin(e,fn.ADMIN)}else"terminate"===t&&(this._disableReconnect=!0,this._disconnectFromHiFiMixer())}}connectToHiFiMixer({webRTCSessionParams:e,customSTUNandTURNConfig:t,timeout:i,initData:n}){if(this._tryingToConnect)return void f.M.warn("`HiFiMixerSession.connectToHiFiMixer()` was called, but is already in the process of connecting. No action will be taken.");if(this.mixerInfo.connected){let e="Already connected! If a reconnect is needed, please hang up and try again.";return void this._onConnectionStateChange(Cn.Connected,{success:!0,error:e,disableReconnect:this._disableReconnect})}if(!this.webRTCAddress){let e="Couldn't connect: `this.webRTCAddress` is falsey!";return void this._onConnectionStateChange(Cn.Failed,{success:!1,error:e,disableReconnect:this._disableReconnect})}let a=!1;const s=e=>{if(e&&e.state===b.UNAVAILABLE){a=!0;let e="High Fidelity server is at capacity; service is unavailable.";this._onConnectionStateChange(Cn.Unavailable,{success:!1,error:e,disableReconnect:this._disableReconnect}),this._raviSignalingConnection.removeStateChangeHandler(s),this._raviSession.closeRAVISession()}};this._raviSignalingConnection.addStateChangeHandler(s),this._raviSignalingConnection.removeStateChangeHandler(this.onRAVISignalingStateChanged),this._raviSession.removeStateChangeHandler(this.onRAVISessionStateChanged),this._tryingToConnect=!0,Promise.resolve().then((()=>(f.M.log("Opening signaling connection"),this._raviSignalingConnection.openRAVISignalingConnection(this.webRTCAddress).catch((e=>{throw`Couldn't open signaling connection to \`${this.webRTCAddress.slice(0,this.webRTCAddress.indexOf("token="))}<token redacted>\`! Error:\n${w.safelyPrintable(e)}`}))))).then((n=>(f.M.log("Signaling connection open; starting RAVI session"),this._raviSession.openRAVISession({signalingConnection:this._raviSignalingConnection,timeout:i,params:e,customStunAndTurn:t}).catch((e=>{let t=`Couldn't open RAVI session associated with \`${this.webRTCAddress.slice(0,this.webRTCAddress.indexOf("token="))}<token redacted>\`! Error:\n${w.safelyPrintable(e)}`;throw a&&(t="High Fidelity server is at capacity; service is unavailable.",this._onConnectionStateChange(Cn.Unavailable,{success:!1,error:t,disableReconnect:this._disableReconnect})),t}))))).then((e=>(f.M.log("Session open; running audionet.init"),this.promiseToRunAudioInit(n).catch((e=>{throw`Connected, but was then unable to communicate the \`audionet.init\` message to the server. Error:\n${w.safelyPrintable(e)}`}))))).then((e=>{f.M.log("audionet.init run; calling state change handler for connected"),this._onConnectionStateChange(Cn.Connected,e)})).then((e=>{this._raviSignalingConnection.addStateChangeHandler(this.onRAVISignalingStateChanged),this._raviSession.addStateChangeHandler(this.onRAVISessionStateChanged)})).catch((e=>{this._onConnectionStateChange(Cn.Failed,{success:!1,error:e,disableReconnect:this._disableReconnect})})).finally((()=>{this._raviSignalingConnection.removeStateChangeHandler(s),this.concurrency=0,this._tryingToConnect=!1}))}disconnectFromHiFiMixer(){return _n(this,void 0,void 0,(function*(){return this._raviDiagnostics.noteExplicitApplicationClose(),this._hifiDiagnostics.noteExplicitApplicationClose(),this._disconnectFromHiFiMixer()}))}_disconnectFromHiFiMixer(){return _n(this,void 0,void 0,(function*(){function e(e,t,i){return _n(this,void 0,void 0,(function*(){if(e){let n=e.getState();if(e&&n!==i)try{e instanceof A?yield e.closeRAVISignalingConnection():e instanceof P&&(yield e.closeRAVISession()),f.M.log(`The RAVI ${t} closed successfully from state ${n}.`)}catch(e){f.M.warn(`The RAVI ${t} didn't close successfully from state ${n}! Error:\n${w.safelyPrintable(e)}`)}else f.M.log(`The RAVI ${t} was already closed.`)}else f.M.warn(`The RAVI ${t} was missing.`);e=null}))}return yield e(this._raviSignalingConnection,"Signaling Connection",b.CLOSED),yield e(this._raviSession,"Session",M.CLOSED),this._resetMixerInfo(),yield this._setMutedByAdmin(!1,fn.INTERNAL),this._onConnectionStateChange(Cn.Disconnected,{success:!0,error:"Successfully disconnected",disableReconnect:this._disableReconnect}),Promise.resolve("Successfully disconnected.")}))}setRAVIInputAudio(e,t=!1){return _n(this,void 0,void 0,(function*(){let i=!1;if(this._raviSession){let n=this._raviSession.getStreamController();n?(n.setInputAudio(e,t),f.M.log("Successfully set input audio on _raviSession.streamController!"),i=!0):(f.M.warn("Couldn't set input audio on _raviSession.streamController: No `streamController`!"),i=!1)}else f.M.warn("Couldn't set input audio on _raviSession.streamController: No `_raviSession`!"),i=!1;if(i&&this._inputAudioMediaStreamIsStereo!=t)if(this._raviSession.getState()===M.CONNECTED){let e;f.M.warn(`Stereo status has changed from ${this._inputAudioMediaStreamIsStereo} to ${t}; attempting to re-initialize with the mixer`);try{this._inputAudioMediaStreamIsStereo=t,e=yield this.promiseToRunAudioInit()}catch(e){let t=`Attempt to call \`audionet.init\` for change in stereo status failed! Error:\n${w.safelyPrintable(e.error)}`;return Promise.reject(t)}}else this._inputAudioMediaStreamIsStereo=t;return i}))}setInputAudioMuted(e,t=!1){return _n(this,void 0,void 0,(function*(){return yield this._setMuted(e,t,fn.CLIENT)}))}_setMutedByAdmin(e,t){return _n(this,void 0,void 0,(function*(){return this._adminPreventsInputAudioUnmuting=e,yield this._setMuted(e||this._lastSuccessfulInputAudioMutedValue,!1,t)}))}_setMuted(e,t,i){return _n(this,void 0,void 0,(function*(){let n=!0;return i==fn.CLIENT&&this._adminPreventsInputAudioUnmuting&&!e&&(f.M.warn("Couldn't set mute state: Muted by admin."),n=!1),n&&(n=yield this._trySetInputAudioMuted(e,t)),n&&(this._lastSuccessfulInputAudioMutedValue=e),this.onMuteChanged&&this.onMuteChanged(new vn({success:n,targetInputAudioMutedValue:e,currentInputAudioMutedValue:this._lastSuccessfulInputAudioMutedValue,adminPreventsInputAudioUnmuting:this._adminPreventsInputAudioUnmuting,muteReason:i})),n}))}_trySetInputAudioMuted(e,t){return _n(this,void 0,void 0,(function*(){let i=this._raviSession.getStreamController();if(!this._raviSession||!i)return f.M.warn("Couldn't set mute state: No `_raviSession`, or `_raviSession.getStreamController()` returned null."),!1;{let n=!1;if("undefined"!=typeof navigator&&navigator.permissions&&navigator.permissions.query){let e;try{e=yield navigator.permissions.query({name:"microphone"})}catch(e){}e&&"granted"===e.state&&(n=!0)}if(t&&n&&"undefined"!=typeof self){let t=i._inputAudioStream;if(t&&e)return t.getTracks().forEach((e=>{this._cachedMediaTrackConstraints=e.getConstraints(),e.stop()})),i.setInputAudio(null),f.M.log("Successfully set mute state to `true` by stopping all input media tracks!"),!0;if(!t&&!e){let e=yield navigator.mediaDevices.getUserMedia({audio:this._cachedMediaTrackConstraints,video:!1});return i.setInputAudio(e),f.M.log("Successfully set mute state to `false` by getting new input media stream!"),!0}if(t&&!e)return t.getTracks().forEach((e=>{e.enabled=!0})),f.M.log("Successfully set mute state to `false` by enabling all tracks on `_raviSession.streamController._inputAudioStream`!"),!0;f.M.warn("Couldn't set mute state: No `_inputAudioStream` on `_raviSession.streamController`.")}else{let t=i._inputAudioStream;if(t)return t.getTracks().forEach((t=>{t.enabled=!e})),f.M.log(`Successfully set mute state to ${e} on _raviSession.streamController._inputAudioStream`),!0;f.M.warn("Couldn't set mute state: No `_inputAudioStream` on `_raviSession.streamController`.")}}}))}getOutputAudioMediaStream(){return this._outputAudioMediaStream}isConnected(){return this._raviSession.getState()===M.CONNECTED&&this._raviSignalingConnection.getState()===b.OPEN}getCurrentHiFiConnectionState(){return this._getUserFacingConnectionState?this._getUserFacingConnectionState():void 0}_onConnectionStateChange(e,t){return _n(this,void 0,void 0,(function*(){if(this.getCurrentHiFiConnectionState()!==e&&(this.onConnectionStateChanged&&this.onConnectionStateChanged(e,t),e===Cn.Connected?(this._raviDiagnostics.prime(this.mixerInfo.visit_id_hash),this._hifiDiagnostics.prime(this.mixerInfo.visit_id_hash),this._copyAudioTracksFromRavi()):this._hifiDiagnostics.fire()),e===Cn.Failed)try{yield this.disconnectFromHiFiMixer()}catch(e){f.M.log(`Error encountered while trying to close the connection. Error:\n${w.safelyPrintable(e)}`)}}))}_copyAudioTracksFromRavi(){let e,t=this._outputAudioMediaStream.getAudioTracks(),i=this._raviSession.getStreamController();i&&i.getAudioStream()&&(e=i.getAudioStream().getAudioTracks()),e&&(f.M.log("Resetting this._outputAudioMediaStream tracks to the current RAVI audio tracks."),t.forEach((e=>this._outputAudioMediaStream.removeTrack(e))),e.forEach((e=>this._outputAudioMediaStream.addTrack(e))))}startCollectingWebRTCStats(e){this._raviSession?(this._statsObserverCallback&&this.stopCollectingWebRTCStats(),this._statsObserverCallback=e,this._raviSession.addStatsObserver(this._statsObserverCallback)):f.M.error("Couldn't start collecting WebRTC stats: No `_raviSession`!")}stopCollectingWebRTCStats(){this._raviSession?(this._raviSession.removeStatsObserver(this._statsObserverCallback),this._statsObserverCallback=void 0):f.M.error("Couldn't stop collecting WebRTC stats: No `_raviSession`!")}_getDataToTransmitToMixer(e,t){let i={};if(e.position&&"number"==typeof e.position.x&&"number"==typeof e.position.y&&"number"==typeof e.position.z){let n={x:!1,y:!1,z:!1,changed:!1};if(t&&t.position?(e.position.x!==t.position.x&&(n.x=!0,n.changed=!0),e.position.y!==t.position.y&&(n.y=!0,n.changed=!0),e.position.z!==t.position.z&&(n.z=!0,n.changed=!0)):(n.x=!0,n.y=!0,n.z=!0,n.changed=!0),n.changed){let t=S.translatePoint3DToMixerSpace(v,e.position);n.x&&(i.x=Math.round(1e3*t.x)),n.y&&(i.y=Math.round(1e3*t.y)),n.z&&(i.z=Math.round(1e3*t.z))}}if(e.orientationQuat&&"number"==typeof e.orientationQuat.w&&"number"==typeof e.orientationQuat.x&&"number"==typeof e.orientationQuat.y&&"number"==typeof e.orientationQuat.z){let n={w:!1,x:!1,y:!1,z:!1,changed:!1};if(t&&t.orientationQuat?(e.orientationQuat.w!==t.orientationQuat.w&&(n.w=!0,n.changed=!0),e.orientationQuat.x!==t.orientationQuat.x&&(n.x=!0,n.changed=!0),e.orientationQuat.y!==t.orientationQuat.y&&(n.y=!0,n.changed=!0),e.orientationQuat.z!==t.orientationQuat.z&&(n.z=!0,n.changed=!0)):(n.w=!0,n.x=!0,n.y=!0,n.z=!0,n.changed=!0),n.changed){let t=S.translateOrientationQuat3DToMixerSpace(v,e.orientationQuat);n.w&&(i.W=1e3*t.w),n.x&&(i.X=1e3*t.x),n.y&&(i.Y=1e3*t.y),i.Z=1e3*t.z}}if("number"!=typeof e.volumeThreshold&&null!==e.volumeThreshold||(i.T=e.volumeThreshold),"number"==typeof e.hiFiGain&&(i.g=Math.max(0,e.hiFiGain)),"number"==typeof e.userAttenuation&&(i.a=e.userAttenuation),"number"==typeof e.userRolloff&&(i.r=Math.max(0,e.userRolloff)),"object"==typeof e._otherUserGainQueue){let n={},a=Object.entries(e._otherUserGainQueue),s=t?t._otherUserGainQueue:void 0;for(const e of a){let t=e[0],i=e[1];"number"==typeof i&&(s&&s[t]===i||(n[t]=i))}Object.entries(n).length&&(i.V=n)}return i}_transmitHiFiAudioAPIDataToServer(e,t){if(!this.mixerInfo.connected||!this._raviSession)return{success:!1,error:"Can't transmit data to mixer; not connected to mixer."};let i=this._getDataToTransmitToMixer(e,t);if(0===Object.keys(i).length)return{success:!0,stringifiedDataForMixer:JSON.stringify({})};{let e=this._raviSession.getCommandController();if(e){let t=JSON.stringify(i);return e.sendInput(t),{success:!0,stringifiedDataForMixer:t}}return{success:!1,error:"Can't transmit data to mixer; no `commandController`!."}}}_resetMixerInfo(){this.mixerInfo={connected:!1},this._mixerPeerKeyToStateCacheDict={}}}!function(e){e.Position="Position",e.OrientationEuler="Orientation (Euler)",e.OrientationQuat="Orientation (Quaternion)",e.VolumeDecibels="Volume (Decibels)",e.IsStereo="IsStereo"}(pn||(pn={}));class bn{constructor({providedUserID:e=null,components:t,callback:i}){this.providedUserID=e,this.components=t,this.callback=i}}var Cn,wn,An=function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed",e.Unavailable="Unavailable"}(Cn||(Cn={})),function(e){e.None="none",e.Peers="peers",e.All="all"}(wn||(wn={}));class yn{constructor({initialHiFiAudioAPIData:e=new h,onConnectionStateChanged:t,onUsersDisconnected:i,transmitRateLimitTimeoutMS:n=_.DEFAULT_TRANSMIT_RATE_LIMIT_TIMEOUT_MS,userDataStreamingScope:s=wn.All,hiFiAxisConfiguration:o,webrtcSessionParams:r,customSTUNandTURNConfig:l,onMuteChanged:d,connectionRetryAndTimeoutConfig:c}={}){if(this._timers={transmitRateLimitTimeout:null,wantedToTransmitHiFiAudioAPIData:!0},this._currentHiFiConnectionState=Cn.Disconnected,l){if(!l.hasOwnProperty("stunUrls")||!Array.isArray(l.stunUrls)||0==l.stunUrls.length)throw new Error("`customSTUNandTURNConfig.stunUrls` must be specified and must be a list containing at least one STUN server.");if(!l.hasOwnProperty("turnUrls")||!Array.isArray(l.turnUrls)||0==l.turnUrls.length)throw new Error("`customSTUNandTURNConfig.turnUrls` must be specified and must be a list containing at least one TURN server.");if(!l.hasOwnProperty("turnUsername"))throw new Error("`customSTUNandTURNConfig.turnUsername` must be specified.");if(!l.hasOwnProperty("turnCredential"))throw new Error("`customSTUNandTURNConfig.turnCredential` must be specified.")}this._customSTUNandTURNConfig=l,n<_.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS&&(f.M.warn(`\`transmitRateLimitTimeoutMS\` must be >= ${_.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS}ms! Setting to ${_.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS}ms...`),n=_.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS),this.transmitRateLimitTimeoutMS=n,i&&(this.onUsersDisconnected=i),t&&(this.onConnectionStateChanged=t),this._connectionRetryAndTimeoutConfig={},Object.assign(this._connectionRetryAndTimeoutConfig,_.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT,c),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection<=0&&(f.M.warn(`\`connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection\` must be greater than 0! Setting to the default (${_.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingInitialConnection}) instead.`),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection=_.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingInitialConnection),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect<=0&&(f.M.warn(`\`connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect\` must be greater than 0! Setting to the default (${_.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingOnDisconnect}) instead.`),this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect=_.DEFAULT_CONNECTION_RETRY_AND_TIMEOUT.maxSecondsToSpendRetryingOnDisconnect),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS<_.MIN_PAUSE_BETWEEN_RETRIES&&(f.M.warn(`\`connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS\` must be >= ${_.MIN_PAUSE_BETWEEN_RETRIES}! Setting to ${_.MIN_PAUSE_BETWEEN_RETRIES}.`),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS=_.MIN_PAUSE_BETWEEN_RETRIES),this._mixerSession=new Sn({userDataStreamingScope:s,onUserDataUpdated:e=>{this._handleUserDataUpdates(e)},onUsersDisconnected:e=>{this._onUsersDisconnected(e)},onConnectionStateChanged:(e,t)=>{this._manageConnection(e,t)},onMuteChanged:d,getUserFacingConnectionState:this.getConnectionState.bind(this)}),this._inputAudioMediaStream=void 0,this._currentHiFiAudioAPIData=new h,this._lastTransmittedHiFiAudioAPIData=new h,this._userDataSubscriptions=[],r&&r.audioMinJitterBufferDuration&&(r.audioMinJitterBufferDuration<0||r.audioMinJitterBufferDuration>10)&&(f.M.warn(`The value of \`webrtcSessionParams.audioMinJitterBufferDuration\` (${r.audioMinJitterBufferDuration}) will be clamped to (0.0, 10.0).`),r.audioMinJitterBufferDuration=a.H.clamp(r.audioMinJitterBufferDuration,0,10)),r&&r.audioMaxJitterBufferDuration&&(r.audioMaxJitterBufferDuration<0||r.audioMaxJitterBufferDuration>10)&&(f.M.warn(`The value of \`webrtcSessionParams.audioMaxJitterBufferDuration\` (${r.audioMaxJitterBufferDuration}) will be clamped to (0.0, 10.0).`),r.audioMaxJitterBufferDuration=a.H.clamp(r.audioMaxJitterBufferDuration,0,10)),this._webRTCSessionParams=r,o&&(S.verify(o)?(v.rightAxis=o.rightAxis,v.leftAxis=o.leftAxis,v.intoScreenAxis=o.intoScreenAxis,v.outOfScreenAxis=o.outOfScreenAxis,v.upAxis=o.upAxis,v.downAxis=o.downAxis,v.handedness=o.handedness,v.eulerOrder=o.eulerOrder):f.M.error("There is an error with the passed `HiFiAxisConfiguration`, so the new axis configuration was not set. There are more error details in the logs above.")),this._updateUserData(e)}getConnectionState(){return this._currentHiFiConnectionState}connectToHiFiAudioAPIServer(e,t,i){return An(this,void 0,void 0,(function*(){if(!this._mixerSession){let e="`this._mixerSession` is falsey; try creating a new HiFiCommunicator and starting over.";return Promise.reject({success:!1,error:e})}if([Cn.Connected,Cn.Connecting,Cn.Reconnecting].includes(this.getConnectionState())){let e="Session is already connected or is in the process of connecting! If you need to reset the connection, please disconnect fully using `disconnectFromHiFiAudioAPIServer()` and call this method again.";return Promise.resolve({success:!0,error:e})}let n;try{let e=new URL(t);n=e.hostname,null==i&&""!==e.port&&(i=Number(e.port))}catch(e){n=t||_.DEFAULT_PROD_HIGH_FIDELITY_ENDPOINT}this._mixerSession._disableReconnect=!1;let a=`wss://${n}:${i=i||_.DEFAULT_PROD_HIGH_FIDELITY_PORT}/?token=`;this._mixerSession.webRTCAddress=`${a}${e}`,f.M.log(`Using WebRTC Signaling Address:\n${a}<token redacted>`);let s=this;return s._failureNotificationPending=void 0,new Promise(((e,t)=>{s._resolveOpen=e,s._rejectOpen=t,this._manageConnection(Cn.Connecting)}))}))}_connectToHiFiMixer(){if(this._mixerSession&&this._mixerSession.webRTCAddress||this._manageConnection(Cn.Failed,{success:!1,error:"_connectToHiFiMixer() must be called after connectToHiFiAudioAPIServer()"}),this._mixerSession.isConnected())throw new Error("Session is already connected! If you need to reset the connection, please disconnect fully using `disconnectFromHiFiAudioAPIServer()` and call this method again.");let e=this._connectionRetryAndTimeoutConfig.timeoutPerConnectionAttemptMS;this._mixerSession.connectToHiFiMixer({webRTCSessionParams:this._webRTCSessionParams,customSTUNandTURNConfig:this._customSTUNandTURNConfig,timeout:e,initData:this._currentHiFiAudioAPIData})}_manageConnection(e,t){switch(e){case Cn.Connecting:case Cn.Reconnecting:return void(this._currentHiFiConnectionState!==Cn.Connected?(f.M.log("_manageConnection: kicking off connection attempt."),this._updateStateAndCallUserStateChangeHandler(e,t),this._connectToHiFiMixer()):f.M.warn(`_manageConnection called for ${e} -- but already connected; taking no action.`));case Cn.Connected:return clearTimeout(this._retryTimerInProgress),this._retryTimerInProgress=null,this._failureNotificationPending=void 0,void this._updateStateAndCallUserStateChangeHandler(e,t);case Cn.Disconnecting:return void this._updateStateAndCallUserStateChangeHandler(e,t);case Cn.Failed:return void(this._failureNotificationPending=t);case Cn.Disconnected:if(this._retryTimerInProgress)return f.M.log("_manageConnection: Timer active; continuing to retry connection"),this._currentHiFiConnectionState!==Cn.Connecting&&this._currentHiFiConnectionState!==Cn.Reconnecting&&(f.M.warn(`_manageConnection handling reconnection, but encountered unexpected state ${this._currentHiFiConnectionState}; will attempt to reconnect, but please contact High Fidelity and report this message`),this._updateStateAndCallUserStateChangeHandler(Cn.Reconnecting,t)),void setTimeout((()=>{this._manageConnection(this._currentHiFiConnectionState)}),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS);let i=0;if(this._currentHiFiConnectionState===Cn.Connecting&&this._connectionRetryAndTimeoutConfig.autoRetryInitialConnection&&!t.disableReconnect)i=1e3*this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingInitialConnection;else if(this._currentHiFiConnectionState===Cn.Reconnecting&&this._connectionRetryAndTimeoutConfig.autoRetryOnDisconnect&&!t.disableReconnect)f.M.warn(`_manageConnection handling reconnection, but is being called for ${e} and there isn't already a timer. Will attempt to reconnect, but please contact High Fidelity and report this message`),i=1e3*this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect;else{if(this._currentHiFiConnectionState!==Cn.Connected||!this._connectionRetryAndTimeoutConfig.autoRetryOnDisconnect||t.disableReconnect)return this._failureNotificationPending?(this._updateStateAndCallUserStateChangeHandler(Cn.Failed,this._failureNotificationPending),this._updateStateAndCallUserStateChangeHandler(Cn.Disconnected,this._failureNotificationPending)):this._updateStateAndCallUserStateChangeHandler(Cn.Disconnected,t),void(this._failureNotificationPending=void 0);i=1e3*this._connectionRetryAndTimeoutConfig.maxSecondsToSpendRetryingOnDisconnect}return void(i>=0&&(f.M.warn("_manageConnection: Attempting retry of connection with timeout "+i),this._retryTimerInProgress=setTimeout((()=>{this._cancelRetriedConnectionAttempts()}),i),this._currentHiFiConnectionState===Cn.Connected?(this._updateStateAndCallUserStateChangeHandler(Cn.Reconnecting,t),setTimeout((()=>{this._manageConnection(Cn.Reconnecting)}),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS)):this._currentHiFiConnectionState===Cn.Connecting&&setTimeout((()=>{this._manageConnection(Cn.Connecting)}),this._connectionRetryAndTimeoutConfig.pauseBetweenRetriesMS)));case Cn.Unavailable:return void this._updateStateAndCallUserStateChangeHandler(e,t);default:return void f.M.error(`_manageConnection called for invalid state change to ${e}; taking no action.`)}}_updateStateAndCallUserStateChangeHandler(e,t){e===Cn.Connected&&(this._lastTransmittedHiFiAudioAPIData=new h,this._transmitHiFiAudioAPIDataToServer(!0)),e!==this._currentHiFiConnectionState&&(this._currentHiFiConnectionState=e,this.onConnectionStateChanged&&this.onConnectionStateChanged(this._currentHiFiConnectionState,t)),e===Cn.Connected&&this._resolveOpen&&(this._resolveOpen(t),this._resolveOpen=void 0,this._rejectOpen=void 0),e!==Cn.Disconnected&&e!==Cn.Unavailable||!this._rejectOpen||(this._rejectOpen(t),this._resolveOpen=void 0,this._rejectOpen=void 0)}_cancelRetriedConnectionAttempts(){f.M.warn("Cancelling retries of connections"),clearTimeout(this._retryTimerInProgress),this._retryTimerInProgress=void 0,this._failureNotificationPending||(this._failureNotificationPending={success:!1,error:"Connection retry attempts unsuccessful"}),this._updateStateAndCallUserStateChangeHandler(Cn.Failed,this._failureNotificationPending),this._mixerSession.disconnectFromHiFiMixer()}disconnectFromHiFiAudioAPIServer(){return An(this,void 0,void 0,(function*(){return this._mixerSession?this._currentHiFiConnectionState===Cn.Disconnecting||this._currentHiFiConnectionState===Cn.Disconnected?Promise.resolve("HiFiCommunicator is already disconnected or in the process of disconnecting."):(this._manageConnection(Cn.Disconnecting),this._lastTransmittedHiFiAudioAPIData=new h,this._mixerSession.disconnectFromHiFiMixer()):Promise.resolve("No mixer session from which we can disconnect!")}))}setOtherUserGainForThisConnection(e,t){return An(this,void 0,void 0,(function*(){let i={};i[e]=t;let n=this.setOtherUserGainsForThisConnection(i);return Promise.resolve(n)}))}setOtherUserGainsForThisConnection(e){return An(this,void 0,void 0,(function*(){Object.assign(this._currentHiFiAudioAPIData._otherUserGainQueue,e);let t=this._transmitHiFiAudioAPIDataToServer();return Promise.resolve({success:t.success,error:t.error})}))}getOutputAudioMediaStream(){return this._mixerSession?this._mixerSession.getOutputAudioMediaStream():null}setInputAudioMediaStream(e,t=!1){return An(this,void 0,void 0,(function*(){const i=yield this._mixerSession.setRAVIInputAudio(e,t);return i?this._inputAudioMediaStream=e:f.M.warn("Error trying to setRAVIInputAudio on this._mixerSession"),i}))}setInputAudioMuted(e){return An(this,void 0,void 0,(function*(){return this._mixerSession?(f.M.debug(`Setting mute state to : ${e}`),yield this._mixerSession.setInputAudioMuted(e)):(f.M.warn("Couldn't set mute state: No `_mixerSession`."),!1)}))}getCommunicatorInfo(){let e={clientInfo:{inputAudioStreamSet:!!this._inputAudioMediaStream}};return"undefined"!=typeof self&&(e.clientInfo.apiVersion="v1.5.0"),this._mixerSession&&this._mixerSession.mixerInfo&&(e.serverInfo=this._mixerSession.mixerInfo),e}startCollectingWebRTCStats(e){this._mixerSession||f.M.error("Couldn't start collecting WebRTC Stats: No `_mixerSession`!"),this._mixerSession.startCollectingWebRTCStats(e)}stopCollectingWebRTCStats(){this._mixerSession||f.M.error("Couldn't stop collecting WebRTC Stats: No `_mixerSession`!"),this._mixerSession.stopCollectingWebRTCStats()}_updateUserData({position:e,orientationQuat:t,orientationEuler:i,volumeThreshold:n,hiFiGain:a,userAttenuation:r,userRolloff:c}={}){var h,u,_,m,g,f,p;if(e&&(this._currentHiFiAudioAPIData.position||(this._currentHiFiAudioAPIData.position=new s),this._currentHiFiAudioAPIData.position.x=null!==(h=e.x)&&void 0!==h?h:this._currentHiFiAudioAPIData.position.x,this._currentHiFiAudioAPIData.position.y=null!==(u=e.y)&&void 0!==u?u:this._currentHiFiAudioAPIData.position.y,this._currentHiFiAudioAPIData.position.z=null!==(_=e.z)&&void 0!==_?_:this._currentHiFiAudioAPIData.position.z),t)this._currentHiFiAudioAPIData.orientationQuat||(this._currentHiFiAudioAPIData.orientationQuat=new o),this._currentHiFiAudioAPIData.orientationQuat.w=null!==(m=t.w)&&void 0!==m?m:this._currentHiFiAudioAPIData.orientationQuat.w,this._currentHiFiAudioAPIData.orientationQuat.x=null!==(g=t.x)&&void 0!==g?g:this._currentHiFiAudioAPIData.orientationQuat.x,this._currentHiFiAudioAPIData.orientationQuat.y=null!==(f=t.y)&&void 0!==f?f:this._currentHiFiAudioAPIData.orientationQuat.y,this._currentHiFiAudioAPIData.orientationQuat.z=null!==(p=t.z)&&void 0!==p?p:this._currentHiFiAudioAPIData.orientationQuat.z;else if(i){let e=new l(i);this._currentHiFiAudioAPIData.orientationQuat=d(e,v.eulerOrder)}"number"!=typeof n&&null!==n||(this._currentHiFiAudioAPIData.volumeThreshold=n),"number"==typeof a&&(this._currentHiFiAudioAPIData.hiFiGain=Math.max(0,a)),"number"==typeof r&&(this._currentHiFiAudioAPIData.userAttenuation=r),"number"==typeof c&&(this._currentHiFiAudioAPIData.userRolloff=Math.max(0,c))}_maybeClearRateLimitTimeout(){this._timers.transmitRateLimitTimeout&&clearTimeout(this._timers.transmitRateLimitTimeout),this._timers.transmitRateLimitTimeout=null}_updateLastTransmittedHiFiAudioAPIData(e){var t,i,n,a,r,l,d;if(e.position&&(this._lastTransmittedHiFiAudioAPIData.position||(this._lastTransmittedHiFiAudioAPIData.position=new s),this._lastTransmittedHiFiAudioAPIData.position.x=null!==(t=e.position.x)&&void 0!==t?t:this._lastTransmittedHiFiAudioAPIData.position.x,this._lastTransmittedHiFiAudioAPIData.position.y=null!==(i=e.position.y)&&void 0!==i?i:this._lastTransmittedHiFiAudioAPIData.position.y,this._lastTransmittedHiFiAudioAPIData.position.z=null!==(n=e.position.z)&&void 0!==n?n:this._lastTransmittedHiFiAudioAPIData.position.z),e.orientationQuat&&(this._lastTransmittedHiFiAudioAPIData.orientationQuat||(this._lastTransmittedHiFiAudioAPIData.orientationQuat=new o),this._lastTransmittedHiFiAudioAPIData.orientationQuat.w=null!==(a=e.orientationQuat.w)&&void 0!==a?a:this._lastTransmittedHiFiAudioAPIData.orientationQuat.w,this._lastTransmittedHiFiAudioAPIData.orientationQuat.x=null!==(r=e.orientationQuat.x)&&void 0!==r?r:this._lastTransmittedHiFiAudioAPIData.orientationQuat.x,this._lastTransmittedHiFiAudioAPIData.orientationQuat.y=null!==(l=e.orientationQuat.y)&&void 0!==l?l:this._lastTransmittedHiFiAudioAPIData.orientationQuat.y,this._lastTransmittedHiFiAudioAPIData.orientationQuat.z=null!==(d=e.orientationQuat.z)&&void 0!==d?d:this._lastTransmittedHiFiAudioAPIData.orientationQuat.z),"number"!=typeof e.volumeThreshold&&null!==e.volumeThreshold||(this._lastTransmittedHiFiAudioAPIData.volumeThreshold=e.volumeThreshold),"number"==typeof e.hiFiGain&&(this._lastTransmittedHiFiAudioAPIData.hiFiGain=e.hiFiGain),"number"==typeof e.userAttenuation&&(this._lastTransmittedHiFiAudioAPIData.userAttenuation=e.userAttenuation),"number"==typeof e.userRolloff&&(this._lastTransmittedHiFiAudioAPIData.userRolloff=e.userRolloff),"object"==typeof e._otherUserGainQueue){"object"!=typeof this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue&&(this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue={});for(const t of Object.entries(e._otherUserGainQueue))this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue[t[0]]=t[1]}}_transmitHiFiAudioAPIDataToServer(e){if(this._mixerSession&&(!this._timers.transmitRateLimitTimeout||e)){this._timers.wantedToTransmitHiFiAudioAPIData=!1,this._maybeClearRateLimitTimeout(),e||(this._timers.transmitRateLimitTimeout=setTimeout((()=>{this._maybeClearRateLimitTimeout(),this._timers.wantedToTransmitHiFiAudioAPIData&&this._transmitHiFiAudioAPIDataToServer(!0)}),this.transmitRateLimitTimeoutMS));let t=this._mixerSession._transmitHiFiAudioAPIDataToServer(this._currentHiFiAudioAPIData,this._lastTransmittedHiFiAudioAPIData);return t.success?(this._updateLastTransmittedHiFiAudioAPIData(this._currentHiFiAudioAPIData),this._cleanUpHiFiAudioAPIDataHistory(),{success:!0,rawDataTransmitted:t.stringifiedDataForMixer}):{success:!1,error:t.error}}return this._mixerSession&&this._timers.transmitRateLimitTimeout&&!e?(this._timers.wantedToTransmitHiFiAudioAPIData=!0,{success:!0,error:"Transfer is rate limited. Transfer will occur shortly automatically."}):this._mixerSession?void 0:{success:!1,error:"No server connection yet; can't transmit user data."}}_cleanUpHiFiAudioAPIDataHistory(){this._currentHiFiAudioAPIData._otherUserGainQueue={},Object.keys(this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue).length>1e3&&(this._lastTransmittedHiFiAudioAPIData._otherUserGainQueue={},f.M.warn("Stored `_lastTransmittedHiFiAudioAPIData._otherUserGainQueue` was too large and was cleared to save space."))}updateUserDataAndTransmit(e){return this._updateUserData(e),this._transmitHiFiAudioAPIDataToServer()}_handleUserDataUpdates(e){if(0!==this._userDataSubscriptions.length)for(let t=0;t<this._userDataSubscriptions.length;t++){let i=this._userDataSubscriptions[t];if(!i.callback)continue;let n=[];for(let t=0;t<e.length;t++){let a=e[t];if(i.providedUserID&&a.providedUserID!==i.providedUserID)continue;let s=new u;"string"==typeof a.providedUserID&&(s.providedUserID=a.providedUserID),"string"==typeof a.hashedVisitID&&(s.hashedVisitID=a.hashedVisitID);let o=!1;for(let e=0;e<i.components.length;e++)switch(i.components[e]){case pn.Position:a.position&&(s.position=a.position,o=!0);break;case pn.OrientationQuat:a.orientationQuat&&(s.orientationQuat=a.orientationQuat,o=!0);break;case pn.OrientationEuler:a.orientationQuat&&(s.orientationEuler=c(a.orientationQuat,v.eulerOrder),o=!0);break;case pn.VolumeDecibels:"number"==typeof a.volumeDecibels&&(s.volumeDecibels=a.volumeDecibels,o=!0);break;case pn.IsStereo:"boolean"==typeof a.isStereo&&(s.isStereo=a.isStereo,o=!0)}o&&n.push(s)}i.callback&&n.length>0&&i.callback(n)}}_onUsersDisconnected(e){this.onUsersDisconnected&&this.onUsersDisconnected(e)}addUserDataSubscription(e){this._mixerSession?this._mixerSession.userDataStreamingScope!==wn.None?(f.M.log(`Adding new User Data Subscription:\n${JSON.stringify(e)}`),this._userDataSubscriptions.push(e)):f.M.error("During `HiFiCommunicator` construction, the server was set up to **not** send user data! Data subscription not added."):f.M.error("No `_mixerSession`! Data subscription not added.")}}"undefined"!=typeof self&&a.H.checkBrowserCompatibility();let Rn="v1.5.0",Tn=a.H.getBestAudioConstraints,In=a.H.preciseInterval},649:(e,t,i)=>{var n;i.d(t,{D:()=>n,M:()=>a}),function(e){e.None="None",e.Error="Error",e.Warn="Warn",e.Debug="Debug"}(n||(n={}));class a{constructor(e){e=e||n.Debug}static setHiFiLogLevel(e){a.logLevel=e}static log(e){return a.logLevel===n.Debug&&(console.log(e),!0)}static debug(e){return this.log(e)}static warn(e){return(a.logLevel===n.Debug||a.logLevel===n.Warn)&&(console.warn(e),!0)}static error(e){return(a.logLevel===n.Debug||a.logLevel===n.Warn||a.logLevel===n.Error)&&(console.error(e),!0)}}a.logLevel=n.Error},24:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>HiFiUtilities});var _HiFiLogger__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(649);function dynamicRequire(e,t){return e.require(t)}let now;if(module=__webpack_require__.hmd(module),"undefined"==typeof self)try{now=dynamicRequire(module,"perf_hooks").performance.now}catch(e){}class HiFiUtilities{constructor(){}static recursivelyDiffObjects(e,t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;let i,n={},a=(e,t,i)=>{let a=Object.prototype.toString.call(e),s=Object.prototype.toString.call(t);if("[object Undefined]"!==s)if(a===s)if("[object Object]"!==a)"[object Array]"!==a?"[object Function]"===a?e.toString()!==t.toString()&&(n[i]=t):e!==t&&(n[i]=t):((e,t)=>{if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0})(e,t)||(n[i]=t);else{let a=HiFiUtilities.recursivelyDiffObjects(e,t);Object.keys(a).length>0&&(n[i]=a)}else n[i]=t;else n[i]=null};for(i in e)e.hasOwnProperty(i)&&a(e[i],t[i],i);for(i in t)t.hasOwnProperty(i)&&(e[i]||e[i]===t[i]||(n[i]=t[i]));return n}static getBestAudioConstraints(){let e={};return"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().echoCancellation&&(e.echoCancellation=!1),"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().noiseSuppression&&(e.noiseSuppression=!1),"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().autoGainControl&&(e.autoGainControl=!1),e}static preciseInterval(e,t){if(!now)return _HiFiLogger__WEBPACK_IMPORTED_MODULE_0__.M.warn("`preciseInterval()` is a wrapper for `setInterval()` in the browser context!"),setInterval(e,t);let i=now(),n=clearTimeout,a=()=>{let o=now();if(o<i)return n=clearImmediate,s=setImmediate(a);i+=t,n=clearTimeout,s=setTimeout(a,i-o-2),e()},s=setTimeout(a);return{clear:()=>n(s)}}static checkBrowserCompatibility(){let requiredFeatures=["navigator","navigator.mediaDevices.getUserMedia","navigator.mediaDevices.getSupportedConstraints","window.MediaStream","window.RTCDataChannel","window.RTCPeerConnection","window.RTCSessionDescription"];for(let i=0;i<requiredFeatures.length;i++)if(void 0===eval(requiredFeatures[i]))return _HiFiLogger__WEBPACK_IMPORTED_MODULE_0__.M.error("HiFi Audio API: The browser does not support: "+requiredFeatures[i]),"navigator.mediaDevices.getUserMedia"===requiredFeatures[i]&&_HiFiLogger__WEBPACK_IMPORTED_MODULE_0__.M.error("HiFi Audio API: Your browser may be preventing access to this feature if you are running in an insecure context, i.e. an `http` server."),!1;return!0}static nonan(e,t){return isNaN(e)?t:e}static clamp(e,t,i){return e>i?i:e<t?t:e}static clampNonan(e,t,i,n){return e>i?i:e<t?t:HiFiUtilities.nonan(e,n)}static clampNormalized(e){return e>1?1:e<-1?-1:e}}},326:(e,t)=>{t.cL=window.MediaStream,window.MediaStreamTrack,window.RTCDataChannel,window.RTCDataChannelEvent,window.RTCDtlsTransport,window.RTCIceCandidate,window.RTCIceTransport,t.I$=window.RTCPeerConnection,window.RTCPeerConnectionIceEvent,window.RTCRtpReceiver,window.RTCRtpSender,window.RTCRtpTransceiver,window.RTCSctpTransport,t.Ao=window.RTCSessionDescription,window.getUserMedia,navigator.mediaDevices},26:e=>{e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.loaded=!0,t.exports}return __webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__(785)})();